import{s as j,j as e,aQ as V,D as _,J as z,m as P,T as f}from"./index-Dt37LTGe.js";import{b as d}from"./vendor-react-q0iRXJvs.js";import{C as N}from"./chart-column-BT80p4kY.js";import{R as I}from"./refresh-cw-bm32xnoH.js";import{S as U}from"./shopping-cart-HI9-gxHz.js";import"./vendor-supabase-DhDedaeW.js";function X(){const[h,v]=d.useState(!0),[q,w]=d.useState([]),[B,S]=d.useState([]),[a,R]=d.useState(null),[o,k]=d.useState(!0),[F,O]=d.useState(new Date),[D,Q]=d.useState("all"),[m,E]=d.useState("all"),[u,$]=d.useState(!1);d.useEffect(()=>{if(g(),o){const t=setInterval(()=>{g()},3e4);return()=>clearInterval(t)}},[o,D,m]);const g=async()=>{try{v(!0);let t=j.from("livestream_events").select("*, organizations(id, name, display_name)").order("start_time",{ascending:!1});m!=="all"&&(t=t.eq("status",m));const{data:r,error:c}=await t;if(c)throw c;const{data:l,error:s}=await j.from("livestream_orders").select("*").eq("status","completed");if(s)throw s;const x=C(r||[],l||[]);w(r||[]),S(l||[]),R(x),O(new Date)}catch(t){console.error("Failed to load analytics:",t)}finally{v(!1)}},C=(t,r)=>{const c=r.reduce((n,i)=>n+parseFloat(i.amount||0),0),l=r.length,s=t.map(n=>{const i=r.filter(b=>b.event_id===n.id),y=i.reduce((b,T)=>b+parseFloat(T.amount||0),0),p=i.length;return{...n,purchases:p,revenue:y,avgOrderValue:p>0?y/p:0}});s.sort((n,i)=>i.revenue-n.revenue);const x={};r.forEach(n=>{const i=new Date(n.created_at).toISOString().split("T")[0];x[i]=(x[i]||0)+parseFloat(n.amount||0)});const A=Object.entries(x).sort((n,i)=>n[0].localeCompare(i[0])).slice(-30);return{totalRevenue:c,totalPurchases:l,totalEvents:t.length,avgOrderValue:l>0?c/l:0,eventStats:s,dailyRevenue:A}},L=()=>{if(!a)return;const t=[["Event","Organization","Purchases","Revenue","Avg Order Value","Status"].join(","),...a.eventStats.map(s=>[`"${s.title}"`,`"${s.organizations?.display_name||s.organization}"`,s.purchases,`$${s.revenue.toFixed(2)}`,`$${s.avgOrderValue.toFixed(2)}`,s.status].join(","))].join(`
`),r=new Blob([t],{type:"text/csv"}),c=URL.createObjectURL(r),l=document.createElement("a");l.href=c,l.download=`livestream-analytics-${new Date().toISOString().split("T")[0]}.csv`,l.click()};return h&&!a?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-black flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-red-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Loading analytics..."})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-black py-8 px-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-white mb-2 flex items-center gap-3",children:[e.jsx(N,{className:"w-8 h-8 text-red-500"}),"Livestream Analytics"]}),e.jsx("p",{className:"text-gray-400",children:"Real-time performance metrics and insights"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>$(!u),className:"px-4 py-2 bg-gray-800/50 hover:bg-gray-700/50 rounded-lg text-gray-300 flex items-center gap-2 transition-all border border-gray-700",children:[e.jsx(V,{className:"w-4 h-4"}),u?"Hide":"Show"," Filters"]}),e.jsxs("button",{onClick:L,className:"px-4 py-2 bg-gray-800/50 hover:bg-gray-700/50 rounded-lg text-gray-300 flex items-center gap-2 transition-all border border-gray-700",children:[e.jsx(_,{className:"w-4 h-4"}),"Export CSV"]}),e.jsxs("button",{onClick:g,disabled:h,className:"px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-white flex items-center gap-2 transition-all disabled:opacity-50",children:[e.jsx(I,{className:`w-4 h-4 ${h?"animate-spin":""}`}),"Refresh"]})]})]}),u&&e.jsx("div",{className:"mb-6 p-4 bg-gray-800/30 backdrop-blur-md rounded-lg border border-gray-700",children:e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-400 mb-2 block",children:"Status"}),e.jsxs("select",{value:m,onChange:t=>E(t.target.value),className:"px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-red-500",children:[e.jsx("option",{value:"all",children:"All Events"}),e.jsx("option",{value:"published",children:"Published"}),e.jsx("option",{value:"live",children:"Live"}),e.jsx("option",{value:"ended",children:"Ended"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-400 mb-2 block",children:"Auto-Refresh"}),e.jsx("button",{onClick:()=>k(!o),className:`px-4 py-2 rounded-lg border transition-all ${o?"bg-red-600 border-red-500 text-white":"bg-gray-900 border-gray-700 text-gray-400"}`,children:o?"ON (30s)":"OFF"})]}),e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"text-sm text-gray-500 self-end",children:["Last updated: ",F.toLocaleTimeString()]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-red-500/20 to-red-600/10 backdrop-blur-md rounded-xl p-6 border border-red-500/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(z,{className:"w-8 h-8 text-red-400"}),e.jsx("span",{className:"text-2xl",children:"ðŸ’°"})]}),e.jsxs("div",{className:"text-3xl font-bold text-white mb-1",children:["$",a?.totalRevenue.toFixed(2)]}),e.jsx("div",{className:"text-sm text-gray-400",children:"Total Revenue"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-500/20 to-blue-600/10 backdrop-blur-md rounded-xl p-6 border border-blue-500/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(U,{className:"w-8 h-8 text-blue-400"}),e.jsx("span",{className:"text-2xl",children:"ðŸŽŸï¸"})]}),e.jsx("div",{className:"text-3xl font-bold text-white mb-1",children:a?.totalPurchases}),e.jsx("div",{className:"text-sm text-gray-400",children:"Total Purchases"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-500/20 to-green-600/10 backdrop-blur-md rounded-xl p-6 border border-green-500/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(P,{className:"w-8 h-8 text-green-400"}),e.jsx("span",{className:"text-2xl",children:"ðŸ“…"})]}),e.jsx("div",{className:"text-3xl font-bold text-white mb-1",children:a?.totalEvents}),e.jsx("div",{className:"text-sm text-gray-400",children:"Total Events"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-500/20 to-purple-600/10 backdrop-blur-md rounded-xl p-6 border border-purple-500/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(f,{className:"w-8 h-8 text-purple-400"}),e.jsx("span",{className:"text-2xl",children:"ðŸ“Š"})]}),e.jsxs("div",{className:"text-3xl font-bold text-white mb-1",children:["$",a?.avgOrderValue.toFixed(2)]}),e.jsx("div",{className:"text-sm text-gray-400",children:"Avg Order Value"})]})]}),e.jsxs("div",{className:"bg-gray-800/30 backdrop-blur-md rounded-xl border border-gray-700 overflow-hidden mb-8",children:[e.jsx("div",{className:"p-6 border-b border-gray-700",children:e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(N,{className:"w-5 h-5 text-red-500"}),"Event Performance"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Event"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Organization"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Purchases"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Revenue"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Avg Order"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:a?.eventStats.map(t=>e.jsxs("tr",{className:"hover:bg-gray-700/30 transition-colors",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-white",children:t.title}),e.jsx("div",{className:"text-xs text-gray-400",children:new Date(t.start_time).toLocaleDateString()})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:t.organizations?.display_name||t.organization}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsx("div",{className:"text-sm font-medium text-white",children:t.purchases})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:"text-sm font-bold text-green-400",children:["$",t.revenue.toFixed(2)]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:"text-sm text-gray-300",children:["$",t.avgOrderValue.toFixed(2)]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${t.status==="live"?"bg-green-500/20 text-green-400":t.status==="published"?"bg-blue-500/20 text-blue-400":t.status==="ended"?"bg-gray-500/20 text-gray-400":"bg-yellow-500/20 text-yellow-400"}`,children:t.status})})]},t.id))})]})}),a?.eventStats.length===0&&e.jsx("div",{className:"text-center py-12 text-gray-500",children:"No events found"})]}),e.jsxs("div",{className:"bg-gray-800/30 backdrop-blur-md rounded-xl border border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-white mb-6 flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5 text-red-500"}),"Revenue Trend (Last 30 Days)"]}),a?.dailyRevenue&&a.dailyRevenue.length>0?e.jsx("div",{className:"space-y-2",children:a.dailyRevenue.map(([t,r])=>{const c=Math.max(...a.dailyRevenue.map(s=>s[1])),l=r/c*100;return e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"text-xs text-gray-400 w-24",children:new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx("div",{className:"flex-1 bg-gray-700/30 rounded-full h-8 overflow-hidden relative",children:e.jsx("div",{className:"bg-gradient-to-r from-red-500 to-red-600 h-full rounded-full transition-all duration-500 flex items-center px-3",style:{width:`${l}%`},children:r>0&&e.jsxs("span",{className:"text-xs font-medium text-white whitespace-nowrap",children:["$",r.toFixed(2)]})})})]},t)})}):e.jsx("div",{className:"text-center py-12 text-gray-500",children:"No revenue data available"})]})]})})}export{X as default};
