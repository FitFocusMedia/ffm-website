import{c as V,s as D,j as e,I as q,D as Q,aS as M,aZ as X,a_ as Z,bf as F,k as H,aM as J}from"./index-D26_ikEn.js";import{b as l}from"./vendor-react-q0iRXJvs.js";import{R as K}from"./refresh-cw-DpU3Y70q.js";import"./vendor-supabase-DhDedaeW.js";const W=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Y=V("circle-x",W);function le(){const[G,L]=l.useState([]),[v,U]=l.useState([]),[$,w]=l.useState(!0),[c,O]=l.useState("all"),[m,A]=l.useState("all"),[x,E]=l.useState(""),[o,R]=l.useState(""),[i,k]=l.useState(""),[h,T]=l.useState(!1),[s,u]=l.useState(null);l.useEffect(()=>{I()},[]);async function I(){w(!0);const{data:t}=await D.from("galleries").select("id, title, slug").order("created_at",{ascending:!1});U(t||[]);const{data:d}=await D.from("gallery_orders").select(`
        *,
        galleries (id, title, slug),
        gallery_order_items (
          id,
          price,
          downloaded,
          download_count,
          gallery_photos (id, filename, thumbnail_path)
        )
      `).order("created_at",{ascending:!1});L(d||[]),w(!1)}function _(t){return v.find(d=>d.id===t)?.title||"Unknown Gallery"}function n(t){return`$${(t/100).toFixed(2)}`}function p(t){return t?new Date(t).toLocaleString("en-AU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-"}function g(t){return t?new Date(t).toLocaleDateString("en-AU",{day:"2-digit",month:"2-digit",year:"numeric"}):"-"}const r=G.filter(t=>{if(c!=="all"&&t.gallery_id!==c||m!=="all"&&t.status!==m||x&&new Date(t.created_at)<new Date(x)||o&&new Date(t.created_at)>new Date(o+"T23:59:59"))return!1;if(i){const d=i.toLowerCase(),y=t.customer_name?.toLowerCase().includes(d),N=t.email?.toLowerCase().includes(d);if(!y&&!N)return!1}return!0}),P=r.filter(t=>t.status==="completed").reduce((t,d)=>t+(d.total_amount||0),0),S=[c!=="all",m!=="all",x,o,i].filter(Boolean).length,j={pending:"bg-yellow-500/20 text-yellow-400",completed:"bg-green-500/20 text-green-400",failed:"bg-red-500/20 text-red-400",refunded:"bg-gray-500/20 text-gray-400"},f=({status:t})=>{switch(t){case"completed":return e.jsx(J,{className:"w-4 h-4"});case"pending":return e.jsx(H,{className:"w-4 h-4"});case"failed":return e.jsx(Y,{className:"w-4 h-4"});case"refunded":return e.jsx(K,{className:"w-4 h-4"});default:return null}};function z(){const t=["Date","Customer","Email","Gallery","Items","Amount","Status","Download Token"],d=r.map(a=>[p(a.created_at),a.customer_name||"-",a.email,a.galleries?.title||_(a.gallery_id),a.is_package?"Full Package":`${a.gallery_order_items?.length||0} photos`,n(a.total_amount),a.status,a.download_token]),y=[t,...d].map(a=>a.map(B=>`"${B}"`).join(",")).join(`
`),N=new Blob([y],{type:"text/csv"}),C=URL.createObjectURL(N),b=document.createElement("a");b.href=C,b.download=`gallery-orders-${new Date().toISOString().split("T")[0]}.csv`,b.click(),URL.revokeObjectURL(C)}return $?e.jsx("div",{className:"min-h-screen bg-dark-950 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-500"})}):e.jsx("div",{className:"min-h-screen bg-dark-950 text-white p-4 md:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold flex items-center gap-2",children:[e.jsx(q,{className:"w-6 h-6 md:w-8 md:h-8 text-red-500"}),"Gallery Orders"]}),e.jsxs("p",{className:"text-gray-400 text-sm mt-1",children:[r.length," orders • ",n(P)," revenue"]})]}),e.jsxs("button",{onClick:z,className:"flex items-center justify-center gap-2 px-4 py-2 bg-dark-800 hover:bg-dark-700 rounded-lg transition-colors text-sm",children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Export"})," CSV"]})]}),e.jsxs("div",{className:"bg-dark-900 rounded-xl mb-6 overflow-hidden",children:[e.jsxs("button",{onClick:()=>T(!h),className:"w-full flex items-center justify-between p-4 md:hidden",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"font-medium",children:"Filters"}),S>0&&e.jsx("span",{className:"bg-red-500 text-white text-xs px-2 py-0.5 rounded-full",children:S})]}),h?e.jsx(X,{className:"w-5 h-5"}):e.jsx(Z,{className:"w-5 h-5"})]}),e.jsxs("div",{className:`p-4 pt-0 md:p-6 ${h?"block":"hidden md:block"}`,children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 hidden md:block",children:"Filters"}),e.jsx("div",{className:"mb-4 md:hidden",children:e.jsxs("div",{className:"relative",children:[e.jsx(F,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",placeholder:"Search name or email...",value:i,onChange:t=>k(t.target.value),className:"w-full bg-dark-800 border border-dark-700 rounded-lg pl-10 pr-4 py-2.5 text-white text-sm"})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs md:text-sm text-gray-400 mb-1",children:"Gallery"}),e.jsxs("select",{value:c,onChange:t=>O(t.target.value),className:"w-full bg-dark-800 border border-dark-700 rounded-lg px-3 py-2 text-white text-sm",children:[e.jsx("option",{value:"all",children:"All"}),v.map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs md:text-sm text-gray-400 mb-1",children:"Status"}),e.jsxs("select",{value:m,onChange:t=>A(t.target.value),className:"w-full bg-dark-800 border border-dark-700 rounded-lg px-3 py-2 text-white text-sm",children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"failed",children:"Failed"}),e.jsx("option",{value:"refunded",children:"Refunded"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs md:text-sm text-gray-400 mb-1",children:"From"}),e.jsx("input",{type:"date",value:x,onChange:t=>E(t.target.value),className:"w-full bg-dark-800 border border-dark-700 rounded-lg px-3 py-2 text-white text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs md:text-sm text-gray-400 mb-1",children:"To"}),e.jsx("input",{type:"date",value:o,onChange:t=>R(t.target.value),className:"w-full bg-dark-800 border border-dark-700 rounded-lg px-3 py-2 text-white text-sm"})]})]}),e.jsxs("div",{className:"mt-4 hidden md:block",children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Search (Name, Email)"}),e.jsxs("div",{className:"relative",children:[e.jsx(F,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",placeholder:"Search orders...",value:i,onChange:t=>k(t.target.value),className:"w-full bg-dark-800 border border-dark-700 rounded-lg pl-10 pr-4 py-2 text-white"})]})]})]})]}),e.jsxs("div",{className:"bg-dark-900 rounded-xl overflow-hidden",children:[e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-dark-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"Customer"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"Gallery"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"Amount"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-dark-800",children:r.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-4 py-8 text-center text-gray-500",children:"No orders found"})}):r.map(t=>e.jsxs("tr",{className:"hover:bg-dark-800/50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("div",{className:"text-sm",children:p(t.created_at).split(",")[0]}),e.jsx("div",{className:"text-xs text-gray-500",children:p(t.created_at).split(",")[1]})]}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("div",{className:"font-medium",children:t.customer_name||"-"}),e.jsx("div",{className:"text-sm text-gray-400",children:t.email})]}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"text-sm",children:t.galleries?.title||_(t.gallery_id)})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"text-sm",children:t.is_package?e.jsx("span",{className:"bg-purple-500/20 text-purple-400 px-2 py-1 rounded text-xs",children:"Full Package"}):`${t.gallery_order_items?.length||0} photos`})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"font-semibold text-green-400",children:n(t.total_amount)})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium ${j[t.status]}`,children:[e.jsx(f,{status:t.status}),t.status]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("button",{onClick:()=>u(t),className:"text-blue-400 hover:text-blue-300 text-sm",children:"View"})})]},t.id))})]})}),e.jsx("div",{className:"md:hidden divide-y divide-dark-800",children:r.length===0?e.jsx("div",{className:"px-4 py-8 text-center text-gray-500",children:"No orders found"}):r.map(t=>e.jsxs("div",{className:"p-4 active:bg-dark-800/50",onClick:()=>u(t),children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.customer_name||"No name"}),e.jsx("div",{className:"text-sm text-gray-400 truncate max-w-[200px]",children:t.email})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-bold text-green-400",children:n(t.total_amount)}),e.jsx("div",{className:"text-xs text-gray-500",children:g(t.created_at)})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-400 truncate max-w-[150px]",children:t.galleries?.title||"Unknown Gallery"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:t.is_package?"Package":`${t.gallery_order_items?.length||0} photos`}),e.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium ${j[t.status]}`,children:e.jsx(f,{status:t.status})})]})]})]},t.id))})]}),s&&e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-end md:items-center justify-center z-50",children:e.jsxs("div",{className:"bg-dark-900 rounded-t-2xl md:rounded-xl w-full md:max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-dark-900 p-4 md:p-6 border-b border-dark-800 z-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg md:text-xl font-bold",children:"Order Details"}),e.jsx("button",{onClick:()=>u(null),className:"text-gray-400 hover:text-white p-2 -mr-2",children:"✕"})]})}),e.jsxs("div",{className:"p-4 md:p-6 space-y-4 md:space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs md:text-sm font-medium text-gray-400 mb-2",children:"Customer"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-3 md:p-4",children:[e.jsx("div",{className:"font-medium",children:s.customer_name||"No name provided"}),e.jsx("div",{className:"text-gray-400 text-sm break-all",children:s.email})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 md:gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs md:text-sm font-medium text-gray-400 mb-2",children:"Gallery"}),e.jsx("div",{className:"bg-dark-800 rounded-lg p-3 md:p-4 text-sm",children:s.galleries?.title||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs md:text-sm font-medium text-gray-400 mb-2",children:"Amount"}),e.jsx("div",{className:"bg-dark-800 rounded-lg p-3 md:p-4 text-green-400 font-bold",children:n(s.total_amount)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 md:gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs md:text-sm font-medium text-gray-400 mb-2",children:"Status"}),e.jsx("div",{className:"bg-dark-800 rounded-lg p-3 md:p-4",children:e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium ${j[s.status]}`,children:[e.jsx(f,{status:s.status}),s.status]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs md:text-sm font-medium text-gray-400 mb-2",children:"Date"}),e.jsx("div",{className:"bg-dark-800 rounded-lg p-3 md:p-4 text-sm",children:g(s.created_at)})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs md:text-sm font-medium text-gray-400 mb-2",children:"Download Token"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-3 md:p-4",children:[e.jsx("code",{className:"text-xs text-yellow-400 break-all",children:s.download_token}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:["Expires: ",g(s.token_expires_at)]})]})]}),s.gallery_order_items&&s.gallery_order_items.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xs md:text-sm font-medium text-gray-400 mb-2",children:["Photos (",s.gallery_order_items.length,")"]}),e.jsx("div",{className:"bg-dark-800 rounded-lg p-3 md:p-4 space-y-2 max-h-48 overflow-y-auto",children:s.gallery_order_items.map(t=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"truncate max-w-[120px] md:max-w-none",children:t.gallery_photos?.filename||"Unknown"}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4 text-xs",children:[e.jsx("span",{className:"text-green-400",children:n(t.price)}),e.jsx("span",{className:t.downloaded?"text-green-400":"text-gray-500",children:t.downloaded?"✓":"-"})]})]},t.id))})]}),(s.stripe_session_id||s.stripe_payment_intent)&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs md:text-sm font-medium text-gray-400 mb-2",children:"Stripe"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-3 md:p-4 text-xs space-y-1 overflow-x-auto",children:[s.stripe_session_id&&e.jsxs("div",{className:"whitespace-nowrap",children:[e.jsx("span",{className:"text-gray-500",children:"Session:"})," ",e.jsx("span",{className:"break-all",children:s.stripe_session_id})]}),s.stripe_payment_intent&&e.jsxs("div",{className:"whitespace-nowrap",children:[e.jsx("span",{className:"text-gray-500",children:"Payment:"})," ",e.jsx("span",{className:"break-all",children:s.stripe_payment_intent})]})]})]})]}),e.jsx("div",{className:"h-6 md:hidden"})]})})]})})}export{le as default};
