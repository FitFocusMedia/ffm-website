import{c as I,s as k,j as e,I as T,D as P,bf as z,k as V,aM as q}from"./index-B2WZatxI.js";import{b as r}from"./vendor-react-q0iRXJvs.js";import{R as B}from"./refresh-cw-BlGKvNgj.js";import"./vendor-supabase-DhDedaeW.js";const Q=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],M=I("circle-x",Q);function W(){const[_,S]=r.useState([]),[j,D]=r.useState([]),[C,f]=r.useState(!0),[c,F]=r.useState("all"),[x,G]=r.useState("all"),[o,O]=r.useState(""),[m,L]=r.useState(""),[h,A]=r.useState(""),[s,y]=r.useState(null);r.useEffect(()=>{E()},[]);async function E(){f(!0);const{data:t}=await k.from("galleries").select("id, title, slug").order("created_at",{ascending:!1});D(t||[]);const{data:l}=await k.from("gallery_orders").select(`
        *,
        galleries (id, title, slug),
        gallery_order_items (
          id,
          price,
          downloaded,
          download_count,
          gallery_photos (id, filename, thumbnail_path)
        )
      `).order("created_at",{ascending:!1});S(l||[]),f(!1)}function N(t){return j.find(l=>l.id===t)?.title||"Unknown Gallery"}function d(t){return`$${(t/100).toFixed(2)}`}function n(t){return t?new Date(t).toLocaleString("en-AU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-"}const i=_.filter(t=>{if(c!=="all"&&t.gallery_id!==c||x!=="all"&&t.status!==x||o&&new Date(t.created_at)<new Date(o)||m&&new Date(t.created_at)>new Date(m+"T23:59:59"))return!1;if(h){const l=h.toLowerCase(),u=t.customer_name?.toLowerCase().includes(l),g=t.email?.toLowerCase().includes(l);if(!u&&!g)return!1}return!0}),R=i.filter(t=>t.status==="completed").reduce((t,l)=>t+(l.total_amount||0),0),b={pending:"bg-yellow-500/20 text-yellow-400",completed:"bg-green-500/20 text-green-400",failed:"bg-red-500/20 text-red-400",refunded:"bg-gray-500/20 text-gray-400"},v=({status:t})=>{switch(t){case"completed":return e.jsx(q,{className:"w-4 h-4"});case"pending":return e.jsx(V,{className:"w-4 h-4"});case"failed":return e.jsx(M,{className:"w-4 h-4"});case"refunded":return e.jsx(B,{className:"w-4 h-4"});default:return null}};function U(){const t=["Date","Customer","Email","Gallery","Items","Amount","Status","Download Token"],l=i.map(a=>[n(a.created_at),a.customer_name||"-",a.email,a.galleries?.title||N(a.gallery_id),a.is_package?"Full Package":`${a.gallery_order_items?.length||0} photos`,d(a.total_amount),a.status,a.download_token]),u=[t,...l].map(a=>a.map($=>`"${$}"`).join(",")).join(`
`),g=new Blob([u],{type:"text/csv"}),w=URL.createObjectURL(g),p=document.createElement("a");p.href=w,p.download=`gallery-orders-${new Date().toISOString().split("T")[0]}.csv`,p.click(),URL.revokeObjectURL(w)}return C?e.jsx("div",{className:"min-h-screen bg-dark-950 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-500"})}):e.jsx("div",{className:"min-h-screen bg-dark-950 text-white p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[e.jsx(T,{className:"w-8 h-8 text-red-500"}),"Gallery Orders"]}),e.jsxs("p",{className:"text-gray-400 mt-1",children:[i.length," orders • ",d(R)," AUD revenue"]})]}),e.jsxs("button",{onClick:U,className:"flex items-center gap-2 px-4 py-2 bg-dark-800 hover:bg-dark-700 rounded-lg transition-colors",children:[e.jsx(P,{className:"w-4 h-4"}),"Export CSV"]})]}),e.jsxs("div",{className:"bg-dark-900 rounded-xl p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Filters"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Gallery"}),e.jsxs("select",{value:c,onChange:t=>F(t.target.value),className:"w-full bg-dark-800 border border-dark-700 rounded-lg px-3 py-2 text-white",children:[e.jsx("option",{value:"all",children:"All Galleries"}),j.map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Status"}),e.jsxs("select",{value:x,onChange:t=>G(t.target.value),className:"w-full bg-dark-800 border border-dark-700 rounded-lg px-3 py-2 text-white",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"failed",children:"Failed"}),e.jsx("option",{value:"refunded",children:"Refunded"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"From Date"}),e.jsx("input",{type:"date",value:o,onChange:t=>O(t.target.value),className:"w-full bg-dark-800 border border-dark-700 rounded-lg px-3 py-2 text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"To Date"}),e.jsx("input",{type:"date",value:m,onChange:t=>L(t.target.value),className:"w-full bg-dark-800 border border-dark-700 rounded-lg px-3 py-2 text-white"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Search (Name, Email)"}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",placeholder:"Search orders...",value:h,onChange:t=>A(t.target.value),className:"w-full bg-dark-800 border border-dark-700 rounded-lg pl-10 pr-4 py-2 text-white"})]})]})]}),e.jsx("div",{className:"bg-dark-900 rounded-xl overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-dark-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"Customer"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"Gallery"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"Amount"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-dark-800",children:i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-4 py-8 text-center text-gray-500",children:"No orders found"})}):i.map(t=>e.jsxs("tr",{className:"hover:bg-dark-800/50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("div",{className:"text-sm",children:n(t.created_at).split(",")[0]}),e.jsx("div",{className:"text-xs text-gray-500",children:n(t.created_at).split(",")[1]})]}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("div",{className:"font-medium",children:t.customer_name||"-"}),e.jsx("div",{className:"text-sm text-gray-400",children:t.email})]}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"text-sm",children:t.galleries?.title||N(t.gallery_id)})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"text-sm",children:t.is_package?e.jsx("span",{className:"bg-purple-500/20 text-purple-400 px-2 py-1 rounded text-xs",children:"Full Package"}):`${t.gallery_order_items?.length||0} photos`})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"font-semibold text-green-400",children:d(t.total_amount)})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium ${b[t.status]}`,children:[e.jsx(v,{status:t.status}),t.status]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("button",{onClick:()=>y(t),className:"text-blue-400 hover:text-blue-300 text-sm",children:"View"})})]},t.id))})]})}),s&&e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-dark-900 rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-dark-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Order Details"}),e.jsx("button",{onClick:()=>y(null),className:"text-gray-400 hover:text-white",children:"✕"})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-2",children:"Customer"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("div",{className:"font-medium",children:s.customer_name||"No name provided"}),e.jsx("div",{className:"text-gray-400",children:s.email})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-2",children:"Gallery"}),e.jsx("div",{className:"bg-dark-800 rounded-lg p-4",children:s.galleries?.title||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-2",children:"Amount"}),e.jsx("div",{className:"bg-dark-800 rounded-lg p-4 text-green-400 font-bold",children:d(s.total_amount)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-2",children:"Status"}),e.jsx("div",{className:"bg-dark-800 rounded-lg p-4",children:e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium ${b[s.status]}`,children:[e.jsx(v,{status:s.status}),s.status]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-2",children:"Order Date"}),e.jsx("div",{className:"bg-dark-800 rounded-lg p-4",children:n(s.created_at)})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-2",children:"Download Token"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("code",{className:"text-xs text-yellow-400 break-all",children:s.download_token}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:["Expires: ",n(s.token_expires_at)]})]})]}),s.gallery_order_items&&s.gallery_order_items.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-400 mb-2",children:["Ordered Photos (",s.gallery_order_items.length,")"]}),e.jsx("div",{className:"bg-dark-800 rounded-lg p-4 space-y-2",children:s.gallery_order_items.map(t=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:t.gallery_photos?.filename||"Unknown photo"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-green-400",children:d(t.price)}),e.jsx("span",{className:t.downloaded?"text-green-400":"text-gray-500",children:t.downloaded?`Downloaded (${t.download_count}x)`:"Not downloaded"})]})]},t.id))})]}),(s.stripe_session_id||s.stripe_payment_intent)&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-2",children:"Stripe"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 text-xs space-y-1",children:[s.stripe_session_id&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Session:"})," ",s.stripe_session_id]}),s.stripe_payment_intent&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Payment Intent:"})," ",s.stripe_payment_intent]})]})]})]})]})})]})})}export{W as default};
