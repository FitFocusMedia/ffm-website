import{j as e,A as u,U as f,T as N,m as v,N as y,M as w}from"./index-Bfn1CFMf.js";import{h as g,b as o}from"./vendor-react-q0iRXJvs.js";import{g as L,a as k,u as C}from"./crmSupabase-B886HBC4.js";import{R as D}from"./refresh-cw-D3822xaD.js";import{T}from"./trophy-3CIePYHm.js";import"./vendor-supabase-DhDedaeW.js";const S=[{id:"new",name:"New",color:"bg-gray-600",textColor:"text-gray-300"},{id:"contacted",name:"Contacted",color:"bg-blue-600",textColor:"text-blue-400"},{id:"meeting",name:"Meeting Booked",color:"bg-purple-600",textColor:"text-purple-400"},{id:"proposal",name:"Proposal Sent",color:"bg-yellow-600",textColor:"text-yellow-400"},{id:"negotiating",name:"Negotiating",color:"bg-orange-600",textColor:"text-orange-400"},{id:"signed",name:"Signed",color:"bg-green-600",textColor:"text-green-400"},{id:"lost",name:"Lost",color:"bg-red-600",textColor:"text-red-400"}];function P({lead:t,onDragStart:l}){const n=g(),r=i=>i>=80?"bg-red-600 text-red-100":i>=60?"bg-orange-600 text-orange-100":"bg-gray-600 text-gray-100";return e.jsxs("div",{draggable:!0,onDragStart:l,onClick:()=>n(`/portal/pipeline/leads/${t.id}`),className:"bg-[#12122a] rounded-lg p-4 border border-gray-800/50 hover:border-gray-700 cursor-move hover:bg-[#16162e] transition-all group",children:[e.jsx("h4",{className:"font-bold text-white group-hover:text-red-400 transition-colors mb-2 line-clamp-2",children:t.org_name}),e.jsxs("div",{className:"space-y-1.5 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[e.jsx(T,{size:14}),e.jsx("span",{className:"truncate",children:t.sport})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[e.jsx(w,{size:14}),e.jsx("span",{className:"truncate",children:t.location})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:`px-2 py-1 rounded text-xs font-bold ${r(t.priority_score)}`,children:["Priority: ",t.priority_score]}),e.jsxs("span",{className:"text-xs font-bold text-gray-600 uppercase",children:["Tier ",t.tier]})]}),e.jsxs("div",{className:"pt-3 border-t border-gray-800/50 space-y-1",children:[e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsx("span",{className:"font-bold",children:"Last Contact:"})," ",t.last_contact?new Date(t.last_contact).toLocaleDateString("en-AU"):"Never"]}),t.revenue_potential&&e.jsx("div",{className:"text-xs text-green-400 font-medium",children:t.revenue_potential})]})]})}function z({column:t,leads:l,onDrop:n,onDragOver:r}){return e.jsxs("div",{onDrop:n,onDragOver:r,className:"flex flex-col min-h-[500px]",children:[e.jsx("div",{className:`${t.color} rounded-t-xl px-4 py-3 mb-3`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-bold text-white text-sm uppercase tracking-wider",children:t.name}),e.jsx("span",{className:"bg-white/20 px-2 py-0.5 rounded-full text-xs font-bold text-white",children:l.length})]})}),e.jsx("div",{className:"flex-1 space-y-3 px-2",children:l.length===0?e.jsx("div",{className:"text-center text-gray-600 text-sm py-8",children:"No leads"}):l.map(i=>e.jsx(P,{lead:i,onDragStart:d=>{d.dataTransfer.effectAllowed="move",d.dataTransfer.setData("leadId",i.id)}},i.id))})]})}function U(){const t=g(),[l,n]=o.useState([]),[r,i]=o.useState({totalLeads:0,activeLeads:0,meetingsThisWeek:0,pipelineValue:0}),[d,x]=o.useState(!0);o.useEffect(()=>{c()},[]);const c=async()=>{x(!0);try{const[s,a]=await Promise.all([L(),k()]);n(s),i({totalLeads:a.totalLeads,activeLeads:a.activeLeads,meetingsThisWeek:a.meetingsThisWeek,pipelineValue:a.pipelineValue})}catch(s){console.error("Error loading pipeline data:",s)}finally{x(!1)}},m=async(s,a)=>{s.preventDefault();const p=s.dataTransfer.getData("leadId");if(p)try{await C(p,{stage:a}),await c()}catch(j){console.error("Error updating lead:",j)}},h=s=>{s.preventDefault()},b=s=>l.filter(a=>a.stage===s);return d?e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx("div",{className:"text-gray-400 text-lg",children:"Loading pipeline..."})}):e.jsxs("div",{className:"min-h-screen bg-[#0d0d1a] pb-8",children:[e.jsx("div",{className:"bg-[#1a1a2e] border-b border-gray-800/50 mb-6",children:e.jsxs("div",{className:"max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>t("/portal/pipeline"),className:"text-gray-400 hover:text-white transition-colors",children:e.jsx(u,{size:24})}),e.jsxs("h1",{className:"text-3xl font-black text-white tracking-tight",children:[e.jsx("span",{className:"text-red-500",children:"PIPELINE"})," BOARD"]})]}),e.jsxs("button",{onClick:c,className:"bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium transition-all flex items-center gap-2 text-sm",children:[e.jsx(D,{size:18}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-[#12122a] rounded-xl p-4 border border-gray-800/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(f,{size:18,className:"text-gray-500"}),e.jsx("div",{className:"text-[10px] font-bold text-gray-500 tracking-widest uppercase",children:"Total Leads"})]}),e.jsx("div",{className:"text-2xl font-black text-white",children:r.totalLeads})]}),e.jsxs("div",{className:"bg-[#12122a] rounded-xl p-4 border border-gray-800/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(N,{size:18,className:"text-pink-500"}),e.jsx("div",{className:"text-[10px] font-bold text-gray-500 tracking-widest uppercase",children:"Active Pipeline"})]}),e.jsx("div",{className:"text-2xl font-black text-pink-500",children:r.activeLeads})]}),e.jsxs("div",{className:"bg-[#12122a] rounded-xl p-4 border border-gray-800/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(v,{size:18,className:"text-purple-500"}),e.jsx("div",{className:"text-[10px] font-bold text-gray-500 tracking-widest uppercase",children:"Meetings This Week"})]}),e.jsx("div",{className:"text-2xl font-black text-purple-500",children:r.meetingsThisWeek})]}),e.jsxs("div",{className:"bg-[#12122a] rounded-xl p-4 border border-gray-800/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(y,{size:18,className:"text-red-400"}),e.jsx("div",{className:"text-[10px] font-bold text-gray-500 tracking-widest uppercase",children:"Pipeline Value"})]}),e.jsxs("div",{className:"text-2xl font-black text-red-400",children:["$",(r.pipelineValue/1e3).toFixed(0),"K"]})]})]})]})}),e.jsx("div",{className:"max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-7 gap-4",children:S.map(s=>e.jsx(z,{column:s,leads:b(s.id),onDrop:a=>m(a,s.id),onDragOver:h},s.id))})})]})}export{U as default};
