import{s as o,j as e}from"./index-CSLGBFp0.js";import{b as l}from"./vendor-react-q0iRXJvs.js";import"./vendor-supabase-DhDedaeW.js";function q(){const[D,k]=l.useState([]),[b,S]=l.useState([]),[C,O]=l.useState([]),[A,P]=l.useState([]),[L,y]=l.useState(!0),[m,z]=l.useState("all"),[x,E]=l.useState("all"),[g,F]=l.useState(""),[h,I]=l.useState(""),[u,$]=l.useState(""),[t,r]=l.useState(null);l.useEffect(()=>{w()},[]);async function w(){y(!0);const{data:s}=await o.from("organizations").select("*").order("name");S(s||[]);const{data:a}=await o.from("events").select("*").order("date",{ascending:!1});O(a||[]);const{data:d}=await o.from("packages").select("*").order("name");P(d||[]);const{data:c}=await o.from("content_orders").select("*").order("created_at",{ascending:!1});k(c||[]),y(!1)}async function _(s){const{error:a}=await o.from("content_orders").update({status:"delivered",delivered_at:new Date().toISOString()}).eq("id",s);a?alert("Failed to update order status"):w()}function j(s){return b.find(a=>a.id===s)?.name||"Unknown"}function p(s){return C.find(a=>a.id===s)?.name||"Unknown"}function f(s){return A.find(a=>a.id===s)?.name||"Unknown"}const i=D.filter(s=>{if(m!=="all"&&s.organization_id!==m||x!=="all"&&s.status!==x||g&&new Date(s.created_at)<new Date(g)||h&&new Date(s.created_at)>new Date(h+"T23:59:59"))return!1;if(u){const a=u.toLowerCase(),d=`${s.first_name} ${s.last_name}`.toLowerCase(),c=s.email?.toLowerCase()||"",v=s.phone?.toLowerCase()||"";if(!d.includes(a)&&!c.includes(a)&&!v.includes(a))return!1}return!0}),T=i.filter(s=>s.status==="paid"||s.status==="delivered").reduce((s,a)=>s+(parseFloat(a.amount)||0),0);function U(){const s=["Date","Customer","Email","Phone","Organization","Event","Package","Amount","Status"],a=i.map(n=>[new Date(n.created_at).toLocaleDateString(),`${n.first_name} ${n.last_name}`,n.email,n.phone||"",j(n.organization_id),p(n.event_id),f(n.package_id),n.amount,n.status]),d=[s,...a].map(n=>n.join(",")).join(`
`),c=new Blob([d],{type:"text/csv"}),v=URL.createObjectURL(c),N=document.createElement("a");N.href=v,N.download=`orders-${new Date().toISOString().split("T")[0]}.csv`,N.click()}return L?e.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"Loading orders..."})}):e.jsxs("div",{className:"min-h-screen bg-black text-white p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Order Management"}),e.jsxs("p",{className:"text-gray-400 mt-1",children:[i.length," orders â€¢ $",T.toFixed(2)," AUD revenue"]})]}),e.jsxs("button",{onClick:U,className:"px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg hover:bg-gray-700 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“¥"}),"Export CSV"]})]}),e.jsxs("div",{className:"bg-gray-900 rounded-lg p-6 mb-6 border border-gray-800",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Filters"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Organization"}),e.jsxs("select",{value:m,onChange:s=>z(s.target.value),className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg",children:[e.jsx("option",{value:"all",children:"All Organizations"}),b.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Status"}),e.jsxs("select",{value:x,onChange:s=>E(s.target.value),className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"processing",children:"Processing"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"refunded",children:"Refunded"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"From Date"}),e.jsx("input",{type:"date",value:g,onChange:s=>F(s.target.value),className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"To Date"}),e.jsx("input",{type:"date",value:h,onChange:s=>I(s.target.value),className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Search (Name, Email, Phone)"}),e.jsx("input",{type:"text",value:u,onChange:s=>$(s.target.value),placeholder:"Search orders...",className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg"})]})]}),e.jsx("div",{className:"bg-gray-900 rounded-lg overflow-hidden border border-gray-800",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-4 text-sm font-semibold",children:"Date"}),e.jsx("th",{className:"text-left p-4 text-sm font-semibold",children:"Customer"}),e.jsx("th",{className:"text-left p-4 text-sm font-semibold",children:"Organization"}),e.jsx("th",{className:"text-left p-4 text-sm font-semibold",children:"Event"}),e.jsx("th",{className:"text-left p-4 text-sm font-semibold",children:"Package"}),e.jsx("th",{className:"text-right p-4 text-sm font-semibold",children:"Amount"}),e.jsx("th",{className:"text-center p-4 text-sm font-semibold",children:"Status"}),e.jsx("th",{className:"text-center p-4 text-sm font-semibold",children:"Actions"})]})}),e.jsx("tbody",{children:i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"text-center p-8 text-gray-500",children:"No orders found"})}):i.map(s=>e.jsxs("tr",{className:"border-t border-gray-800 hover:bg-gray-800/50",children:[e.jsxs("td",{className:"p-4 text-sm",children:[new Date(s.created_at).toLocaleDateString(),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(s.created_at).toLocaleTimeString()})]}),e.jsxs("td",{className:"p-4",children:[e.jsxs("div",{className:"font-medium",children:[s.first_name," ",s.last_name]}),e.jsx("div",{className:"text-sm text-gray-400",children:s.email}),s.phone&&e.jsx("div",{className:"text-xs text-gray-500",children:s.phone})]}),e.jsx("td",{className:"p-4 text-sm",children:j(s.organization_id)}),e.jsx("td",{className:"p-4 text-sm",children:p(s.event_id)}),e.jsx("td",{className:"p-4 text-sm",children:f(s.package_id)}),e.jsxs("td",{className:"p-4 text-right font-semibold",children:["$",s.amount]}),e.jsx("td",{className:"p-4 text-center",children:e.jsx("span",{className:`inline-block px-3 py-1 rounded-full text-xs font-medium ${s.status==="delivered"?"bg-green-500/20 text-green-400":s.status==="paid"?"bg-blue-500/20 text-blue-400":s.status==="processing"?"bg-yellow-500/20 text-yellow-400":s.status==="refunded"?"bg-red-500/20 text-red-400":"bg-gray-500/20 text-gray-400"}`,children:s.status})}),e.jsxs("td",{className:"p-4 text-center",children:[e.jsx("button",{onClick:()=>r(s),className:"text-blue-400 hover:text-blue-300 text-sm mr-3",children:"View"}),s.status==="paid"&&e.jsx("button",{onClick:()=>_(s.id),className:"text-green-400 hover:text-green-300 text-sm",children:"Mark Delivered"})]})]},s.id))})]})})]}),t&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",onClick:()=>r(null),children:e.jsxs("div",{className:"bg-gray-900 rounded-lg max-w-2xl w-full p-6 border border-gray-800",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Order Details"}),e.jsx("button",{onClick:()=>r(null),className:"text-gray-400 hover:text-white",children:"âœ•"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold mb-3 text-red-500",children:"Customer Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Name:"}),e.jsxs("div",{className:"font-medium",children:[t.first_name," ",t.last_name]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Email:"}),e.jsx("div",{className:"font-medium",children:t.email})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Phone:"}),e.jsx("div",{className:"font-medium",children:t.phone||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Instagram:"}),e.jsxs("div",{className:"font-medium",children:["@",t.instagram||"N/A"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Division:"}),e.jsx("div",{className:"font-medium",children:t.division||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Coach:"}),e.jsxs("div",{className:"font-medium",children:[t.coach_name||"N/A"," (@",t.coach_instagram||"N/A",")"]})]})]})]}),e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold mb-3 text-red-500",children:"Order Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Organization:"}),e.jsx("div",{className:"font-medium",children:j(t.organization_id)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Event:"}),e.jsx("div",{className:"font-medium",children:p(t.event_id)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Package:"}),e.jsx("div",{className:"font-medium",children:f(t.package_id)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Amount:"}),e.jsxs("div",{className:"font-medium text-lg",children:["$",t.amount," ",t.currency]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Status:"}),e.jsx("div",{className:"font-medium",children:t.status})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Order Date:"}),e.jsx("div",{className:"font-medium",children:new Date(t.created_at).toLocaleString()})]}),t.paid_at&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Paid At:"}),e.jsx("div",{className:"font-medium",children:new Date(t.paid_at).toLocaleString()})]}),t.delivered_at&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Delivered At:"}),e.jsx("div",{className:"font-medium",children:new Date(t.delivered_at).toLocaleString()})]})]})]}),e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold mb-3 text-red-500",children:"Payment Information"}),e.jsxs("div",{className:"text-sm space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Stripe Session ID:"}),e.jsx("div",{className:"font-mono text-xs break-all",children:t.stripe_session_id})]}),t.stripe_payment_id&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Payment Intent ID:"}),e.jsx("div",{className:"font-mono text-xs break-all",children:t.stripe_payment_id})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[t.status==="paid"&&e.jsx("button",{onClick:()=>{_(t.id),r(null)},className:"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg font-medium",children:"Mark as Delivered"}),e.jsx("button",{onClick:()=>r(null),className:"flex-1 px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg font-medium",children:"Close"})]})]})]})})]})}export{q as default};
