import{o as A,n as F,p as j,q as I,j as e,r as N,i as w,m as O,k as T,M as $,P as R,v as W,w as Y}from"./index-DHjbTfMz.js";import{h as q,e as G,b as r}from"./vendor-react-q0iRXJvs.js";import{L as z}from"./log-out-8XURNEdk.js";import"./vendor-supabase-DhDedaeW.js";function K(){const m=q();G();const[c,i]=r.useState(null),[x,d]=r.useState([]),[v,k]=r.useState(!0),[l,S]=r.useState(""),[u,h]=r.useState(!1),[_,g]=r.useState(!1),[p,o]=r.useState(null);r.useEffect(()=>{E();const{data:{subscription:s}}=A(async(t,a)=>{if(t==="SIGNED_IN"&&a?.user){i(a.user);try{await j(a.user.id,a.user.email)}catch(n){console.error("Failed to sync profile:",n)}f(a.user.email)}else t==="SIGNED_OUT"&&(i(null),d([]))});return()=>s.unsubscribe()},[]);const E=async()=>{try{const s=await F();if(s?.user){i(s.user);try{await j(s.user.id,s.user.email)}catch(t){console.error("Failed to sync profile:",t)}await f(s.user.email)}}catch(s){console.error("Auth check failed:",s)}finally{k(!1)}},f=async s=>{try{const t=await I(s);d(t||[])}catch(t){console.error("Failed to load purchases:",t),o("Failed to load your purchases")}},P=async s=>{if(s.preventDefault(),!!l){h(!0),o(null);try{await W(l,`${window.location.origin}/#/my-purchases`),g(!0)}catch(t){o("Failed to send login link. Please try again."),console.error("Magic link error:",t)}finally{h(!1)}}},D=async()=>{await Y(),i(null),d([])},b=s=>new Date(s).toLocaleDateString("en-AU",{weekday:"short",day:"numeric",month:"short",year:"numeric"}),L=s=>new Date(s).toLocaleTimeString("en-AU",{hour:"2-digit",minute:"2-digit"}),C=s=>{const t=new Date,a=new Date(s.start_time),n=new Date(s.end_time);return t>=a&&t<=n&&s.is_live},U=s=>new Date(s.start_time)>new Date,M=s=>new Date(s.end_time)<new Date;return v?e.jsx("div",{className:"min-h-screen bg-dark-950 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-500"})}):c?e.jsx("div",{className:"min-h-screen bg-dark-950",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"My Purchases"}),e.jsx("p",{className:"text-gray-400",children:c.email})]}),e.jsxs("button",{onClick:D,className:"flex items-center gap-2 px-4 py-2 text-gray-400 hover:text-white transition-colors",children:[e.jsx(z,{className:"w-5 h-5"}),"Sign Out"]})]}),x.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(N,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-white mb-2",children:"No Purchases Yet"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"You haven't purchased any events yet."}),e.jsx("button",{onClick:()=>m("/live"),className:"px-6 py-3 bg-red-500 hover:bg-red-600 text-white font-semibold rounded-lg transition-colors",children:"Browse Events"})]}):e.jsx("div",{className:"space-y-4",children:x.map(s=>{const t=s.event,a=C(t),n=U(t),y=M(t);return e.jsx("div",{className:"bg-dark-900 rounded-xl border border-dark-800 overflow-hidden hover:border-dark-700 transition-colors",children:e.jsxs("div",{className:"flex flex-col md:flex-row",children:[t.thumbnail_url&&e.jsx("div",{className:"md:w-48 h-32 md:h-auto flex-shrink-0",children:e.jsx("img",{src:t.thumbnail_url,alt:t.title,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 p-5",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:t.title}),a&&e.jsxs("span",{className:"px-2 py-0.5 bg-red-500 text-white text-xs font-bold rounded-full flex items-center gap-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-white rounded-full animate-pulse"}),"LIVE"]}),n&&e.jsx("span",{className:"px-2 py-0.5 bg-blue-500/20 text-blue-400 text-xs font-medium rounded-full",children:"Upcoming"}),y&&!t.mux_playback_id&&e.jsx("span",{className:"px-2 py-0.5 bg-gray-500/20 text-gray-400 text-xs font-medium rounded-full",children:"Ended"}),y&&t.mux_playback_id&&e.jsx("span",{className:"px-2 py-0.5 bg-green-500/20 text-green-400 text-xs font-medium rounded-full",children:"Replay Available"})]}),e.jsx("p",{className:"text-gray-400 text-sm mb-3",children:t.org_display_name||t.organization}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(O,{className:"w-4 h-4"}),b(t.start_time)]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"w-4 h-4"}),L(t.start_time)]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($,{className:"w-4 h-4"}),t.venue]})]})]}),(a||n||t.mux_playback_id)&&e.jsxs("button",{onClick:()=>m(`/watch/${t.id}?email=${encodeURIComponent(c.email)}`),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors flex-shrink-0 ${a?"bg-red-500 hover:bg-red-600 text-white":"bg-dark-800 hover:bg-dark-700 text-white"}`,children:[e.jsx(R,{className:"w-5 h-5"}),a?"Watch Live":n?"Watch":"Replay"]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-dark-800 flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:["Purchased ",b(s.created_at)]}),e.jsxs("span",{className:"text-green-500 font-medium",children:["$",s.amount," AUD"]})]})]})]})},s.id)})})]})}):e.jsx("div",{className:"min-h-screen bg-dark-950 flex items-center justify-center px-4",children:e.jsxs("div",{className:"max-w-md w-full",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx(N,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"My Purchases"}),e.jsx("p",{className:"text-gray-400",children:"Enter your email to access your purchased events"})]}),_?e.jsxs("div",{className:"bg-green-500/10 border border-green-500/30 rounded-xl p-6 text-center",children:[e.jsx(w,{className:"w-12 h-12 text-green-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"Check Your Email!"}),e.jsxs("p",{className:"text-gray-400 mb-4",children:["We've sent a login link to ",e.jsx("span",{className:"text-white font-medium",children:l})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Click the link in your email to access your purchases. The link expires in 1 hour."}),e.jsx("button",{onClick:()=>g(!1),className:"mt-4 text-red-500 hover:text-red-400 text-sm",children:"Use a different email"})]}):e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Email Address"}),e.jsx("input",{type:"email",value:l,onChange:s=>S(s.target.value),placeholder:"your@email.com",className:"w-full px-4 py-3 bg-dark-800 border border-dark-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500",required:!0})]}),p&&e.jsx("div",{className:"text-red-500 text-sm",children:p}),e.jsx("button",{type:"submit",disabled:u||!l,className:"w-full py-3 bg-red-500 hover:bg-red-600 disabled:bg-dark-700 disabled:text-gray-500 text-white font-semibold rounded-lg transition-colors flex items-center justify-center gap-2",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-white"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"w-5 h-5"}),"Send Login Link"]})}),e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"No password needed! We'll email you a secure login link."})]})]})})}export{K as default};
