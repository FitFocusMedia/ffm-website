import{s as l,j as e,h as ye}from"./index-CNKPiQ9n.js";import{b as i}from"./vendor-react-q0iRXJvs.js";import"./vendor-supabase-DhDedaeW.js";function Ne({event:f,organization:te,onBack:c,onEventUpdate:P}){const[_,ce]=i.useState("details"),[J,se]=i.useState(!0),[j,ae]=i.useState(f),[E,F]=i.useState([]),[O,oe]=i.useState([]),[Q,je]=i.useState([]),[y,T]=i.useState([]),[V,U]=i.useState(""),[re,R]=i.useState(!1),[N,le]=i.useState(""),[L,ie]=i.useState("all"),[g,xe]=i.useState("all"),[w,Y]=i.useState(!1),[r,d]=i.useState({}),[A,H]=i.useState(!1),[m,K]=i.useState(null),[B,G]=i.useState(!1),[$,ne]=i.useState(!1);i.useEffect(()=>{D()},[f.id]);async function D(){se(!0);const[t,s,a]=await Promise.all([l.from("content_orders").select("*, packages(name)").eq("event_id",f.id).order("created_at",{ascending:!1}),l.from("galleries").select("*, gallery_photos(count)").eq("event_id",f.id),l.from("event_athletes").select("*").eq("event_id",f.id).order("competition_time",{ascending:!0})]);F(t.data||[]),oe(s.data||[]),T(a.data||[]),se(!1)}function z(t){const s=t.trim().split(`
`).filter(n=>n.trim()),a=[];for(const n of s){const o=n.split("|").map(u=>u.trim());o.length>=1&&a.push({name:o[0]||"",division:o[1]||"",mat:o[2]||"",competition_time:o[3]||"",academy:o[4]||"",event_id:f.id,status:"pending",captured:!1})}return a}async function ve(){const t=z(V);if(t.length===0){alert("No valid athlete data found");return}const{error:s}=await l.from("event_athletes").insert(t);s?alert("Error importing athletes: "+s.message):(R(!1),U(""),D())}async function X(t,s){const{error:a}=await l.from("event_athletes").update({captured:!s,captured_at:s?null:new Date().toISOString()}).eq("id",t);a||T(n=>n.map(o=>o.id===t?{...o,captured:!s}:o))}async function I(t){if(!confirm("Delete this athlete?"))return;const{error:s}=await l.from("event_athletes").delete().eq("id",t);s||T(a=>a.filter(n=>n.id!==t))}async function C(){if(!confirm("Delete ALL athletes for this event? This cannot be undone."))return;const{error:t}=await l.from("event_athletes").delete().eq("event_id",f.id);t||T([])}async function me(t){if(!(!t||!m)){G(!0);try{const s=t.name.split(".").pop(),a=`${m.id}-${Date.now()}.${s}`,{data:n,error:o}=await l.storage.from("match-cards").upload(a,t);if(o)throw o;const{data:u}=l.storage.from("match-cards").getPublicUrl(a),x=u.publicUrl,{error:p}=await l.from("content_orders").update({match_card_url:x}).eq("id",m.id);if(p)throw p;F(S=>S.map(b=>b.id===m.id?{...b,match_card_url:x}:b)),await ge(x,m.id),H(!1),K(null)}catch(s){console.error("Upload error:",s),alert("Error uploading match card: "+s.message)}finally{G(!1)}}}async function ge(t,s){ne(!0);try{const{data:a,error:n}=await l.functions.invoke("extract-match-card",{body:{imageUrl:t,orderId:s}});if(n){console.error("Extraction error:",n);return}const{error:o}=await l.from("content_orders").update({match_card_data:a}).eq("id",s);if(!o&&(F(u=>u.map(x=>x.id===s?{...x,match_card_data:a}:x)),a.mat||a.time||a.division)){const u=E.find(x=>x.id===s);u&&await Z(u,a)}}catch(a){console.error("Extraction error:",a)}finally{ne(!1)}}async function Z(t,s){const a=`${t.first_name||""} ${t.last_name||""}`.trim(),{data:n}=await l.from("event_athletes").select("id").eq("event_id",f.id).ilike("name",a).single(),o={event_id:f.id,name:a,division:s.division||null,mat:s.mat||null,competition_time:s.time||null,email:t.email||null,status:"pending",captured:!1};n?await l.from("event_athletes").update(o).eq("id",n.id):await l.from("event_athletes").insert(o),D()}function W(t){K(t),H(!0)}async function k(){const{error:t}=await l.from("events").update(r).eq("id",f.id);t?alert("Error saving: "+t.message):(ae({...j,...r}),Y(!1),P&&P())}const he=y.filter(t=>{const s=!N||t.name?.toLowerCase().includes(N.toLowerCase())||t.academy?.toLowerCase().includes(N.toLowerCase())||t.division?.toLowerCase().includes(N.toLowerCase()),a=L==="all"||L==="captured"&&t.captured||L==="pending"&&!t.captured||L==="paid"&&E.some(o=>`${o.first_name} ${o.last_name}`.toLowerCase()===t.name?.toLowerCase()||o.email?.toLowerCase()===t.email?.toLowerCase()),n=g==="all"||t.mat===g;return s&&a&&n}),q=[...new Set(y.map(t=>t.mat).filter(Boolean))],ee=new Set(E.map(t=>`${t.first_name||""} ${t.last_name||""}`.toLowerCase().trim()).filter(Boolean)),M=y.filter(t=>ee.has(t.name?.toLowerCase())&&!t.captured).sort((t,s)=>t.competition_time&&s.competition_time?t.competition_time.localeCompare(s.competition_time):0),de=[{id:"details",label:"Details"},{id:"athletes",label:`Athletes (${y.length})`},{id:"runsheet",label:"Run Sheet"},{id:"gallery",label:`Gallery (${O.length})`},{id:"orders",label:`Orders (${E.length})`}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("button",{onClick:c,className:"flex items-center gap-2 text-gray-400 hover:text-white transition-colors",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Back to Events"]})}),e.jsx("div",{className:"text-right",children:e.jsx("span",{className:`px-3 py-1 rounded text-sm ${j.status==="upcoming"?"bg-blue-600":j.status==="active"?"bg-green-600":"bg-gray-600"}`,children:j.status})})]}),e.jsxs("div",{className:"bg-gray-900/50 rounded-xl border border-gray-800 p-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:j.name}),e.jsxs("p",{className:"text-gray-400 mt-1",children:[j.date&&new Date(j.date).toLocaleDateString("en-AU",{weekday:"long",day:"numeric",month:"long",year:"numeric"}),j.location&&` â€¢ ${j.location}`]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:te?.name})]}),e.jsx("div",{className:"flex gap-2 border-b border-gray-700 pb-2",children:de.map(t=>e.jsx("button",{onClick:()=>ce(t.id),className:`px-4 py-2 rounded-t-lg transition-colors ${_===t.id?"bg-red-600 text-white":"text-gray-400 hover:text-white"}`,children:t.label},t.id))}),J?e.jsx("div",{className:"text-center py-12 text-gray-400",children:"Loading..."}):e.jsxs(e.Fragment,{children:[_==="details"&&e.jsx("div",{className:"bg-gray-900/50 rounded-xl border border-gray-800 p-6 space-y-4",children:w?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Event Name"}),e.jsx("input",{type:"text",value:r.name||"",onChange:t=>d({...r,name:t.target.value}),className:"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Date"}),e.jsx("input",{type:"date",value:r.date?.split("T")[0]||"",onChange:t=>d({...r,date:t.target.value}),className:"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Location"}),e.jsx("input",{type:"text",value:r.location||"",onChange:t=>d({...r,location:t.target.value}),className:"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Status"}),e.jsxs("select",{value:r.status||"upcoming",onChange:t=>d({...r,status:t.target.value}),className:"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg",children:[e.jsx("option",{value:"upcoming",children:"Upcoming"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"completed",children:"Completed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Active"}),e.jsxs("select",{value:r.active?"true":"false",onChange:t=>d({...r,active:t.target.value==="true"}),className:"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg",children:[e.jsx("option",{value:"true",children:"Yes"}),e.jsx("option",{value:"false",children:"No"})]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx("button",{onClick:k,className:"px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg",children:"Save Changes"}),e.jsx("button",{onClick:()=>Y(!1),className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg",children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Event Name"}),e.jsx("p",{className:"font-medium",children:j.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Date"}),e.jsx("p",{className:"font-medium",children:j.date&&new Date(j.date).toLocaleDateString("en-AU")})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Location"}),e.jsx("p",{className:"font-medium",children:j.location||"Not set"})]})]}),e.jsx("button",{onClick:()=>{d(j),Y(!0)},className:"mt-4 px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg",children:"Edit Details"})]})}),_==="athletes"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Search athletes...",value:N,onChange:t=>le(t.target.value),className:"px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg w-64"}),e.jsxs("select",{value:g,onChange:t=>xe(t.target.value),className:"px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg",children:[e.jsx("option",{value:"all",children:"All Mats"}),q.map(t=>e.jsxs("option",{value:t,children:["Mat ",t]},t))]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>R(!0),className:"px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg",children:"Import from Smoothcomp"}),y.length>0&&e.jsx("button",{onClick:C,className:"px-4 py-2 bg-red-900 hover:bg-red-800 rounded-lg text-sm",children:"Clear All"})]})]}),y.length===0?e.jsxs("div",{className:"bg-gray-900/50 rounded-xl border border-gray-800 p-8 text-center text-gray-400",children:[e.jsx("p",{children:"No athletes imported yet."}),e.jsx("p",{className:"text-sm mt-2",children:"Import from Smoothcomp to get started."})]}):e.jsx("div",{className:"bg-gray-900/50 rounded-xl border border-gray-800 overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3",children:"Name"}),e.jsx("th",{className:"text-left p-3",children:"Division"}),e.jsx("th",{className:"text-center p-3",children:"Mat"}),e.jsx("th",{className:"text-center p-3",children:"Time"}),e.jsx("th",{className:"text-left p-3",children:"Academy"}),e.jsx("th",{className:"text-center p-3",children:"Paid"}),e.jsx("th",{className:"text-center p-3",children:"Captured"}),e.jsx("th",{className:"text-right p-3",children:"Actions"})]})}),e.jsx("tbody",{children:he.map(t=>{const s=ee.has(t.name?.toLowerCase());return e.jsxs("tr",{className:`border-t border-gray-800 ${s&&!t.captured?"bg-yellow-900/20":""}`,children:[e.jsx("td",{className:"p-3 font-medium",children:t.name}),e.jsx("td",{className:"p-3 text-gray-400",children:t.division}),e.jsx("td",{className:"p-3 text-center",children:t.mat}),e.jsx("td",{className:"p-3 text-center text-gray-400",children:t.competition_time}),e.jsx("td",{className:"p-3 text-gray-400",children:t.academy}),e.jsx("td",{className:"p-3 text-center",children:s?e.jsx("span",{className:"text-green-400",children:"ðŸ’°"}):e.jsx("span",{className:"text-gray-600",children:"-"})}),e.jsx("td",{className:"p-3 text-center",children:e.jsx("button",{onClick:()=>X(t.id,t.captured),className:`px-2 py-1 rounded text-xs ${t.captured?"bg-green-600":"bg-gray-600 hover:bg-gray-500"}`,children:t.captured?"âœ“":"â—‹"})}),e.jsx("td",{className:"p-3 text-right",children:e.jsx("button",{onClick:()=>I(t.id),className:"text-red-400 hover:text-red-300",children:"Delete"})})]},t.id)})})]})})]}),_==="runsheet"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-yellow-900/20 border border-yellow-800 rounded-xl p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-yellow-400 mb-4",children:["ðŸ”¥ Priority Queue (",M.length,")"]}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Athletes who have PAID but not yet been photographed. Capture these first!"}),M.length===0?e.jsx("p",{className:"text-gray-500 italic",children:"No pending captures. All paid athletes have been photographed!"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:M.map(t=>e.jsx("div",{className:"bg-gray-800 rounded-lg p-4 border border-yellow-700",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:t.name}),e.jsx("p",{className:"text-sm text-gray-400",children:t.division}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Mat ",t.mat," â€¢ ",t.competition_time]})]}),e.jsx("button",{onClick:()=>X(t.id,!1),className:"px-3 py-1 bg-green-600 hover:bg-green-700 rounded text-sm",children:"Mark Captured"})]})},t.id))})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gray-900/50 rounded-xl border border-gray-800 p-4 text-center",children:[e.jsx("p",{className:"text-3xl font-bold",children:y.length}),e.jsx("p",{className:"text-sm text-gray-400",children:"Total Athletes"})]}),e.jsxs("div",{className:"bg-gray-900/50 rounded-xl border border-gray-800 p-4 text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-green-400",children:E.length}),e.jsx("p",{className:"text-sm text-gray-400",children:"Orders"})]}),e.jsxs("div",{className:"bg-gray-900/50 rounded-xl border border-gray-800 p-4 text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-yellow-400",children:M.length}),e.jsx("p",{className:"text-sm text-gray-400",children:"Pending Captures"})]}),e.jsxs("div",{className:"bg-gray-900/50 rounded-xl border border-gray-800 p-4 text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-blue-400",children:y.filter(t=>t.captured).length}),e.jsx("p",{className:"text-sm text-gray-400",children:"Captured"})]})]}),e.jsxs("div",{className:"bg-gray-900/50 rounded-xl border border-gray-800 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Timeline View"}),y.length===0?e.jsx("p",{className:"text-gray-500 italic",children:"Import athletes to see the timeline."}):e.jsx("div",{className:"space-y-2",children:Object.entries(y.reduce((t,s)=>{const a=s.competition_time||"No Time Set";return t[a]||(t[a]=[]),t[a].push(s),t},{})).sort(([t],[s])=>t.localeCompare(s)).map(([t,s])=>e.jsxs("div",{className:"border-l-2 border-gray-700 pl-4 py-2",children:[e.jsx("p",{className:"font-semibold text-gray-300",children:t}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:s.map(a=>{const n=ee.has(a.name?.toLowerCase());return e.jsxs("span",{className:`px-3 py-1 rounded text-sm ${a.captured?"bg-green-900/50 text-green-400 line-through":n?"bg-yellow-900/50 text-yellow-400 font-semibold":"bg-gray-800 text-gray-400"}`,children:[a.name,n&&!a.captured&&" ðŸ’°"]},a.id)})})]},t))})]})]}),_==="gallery"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Event Galleries"}),e.jsx("a",{href:`#/portal/galleries?event=${f.id}&org=${te?.id}`,className:"px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg",children:"Manage Galleries"})]}),O.length===0?e.jsx("div",{className:"bg-gray-900/50 rounded-xl border border-gray-800 p-8 text-center text-gray-400",children:"No galleries for this event yet."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:O.map(t=>e.jsxs("div",{className:"bg-gray-900/50 rounded-xl border border-gray-800 p-4",children:[e.jsx("h4",{className:"font-semibold",children:t.title}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:t.description}),e.jsxs("div",{className:"flex gap-4 mt-3 text-sm text-gray-500",children:[e.jsxs("span",{children:[t.gallery_photos?.[0]?.count||0," photos"]}),e.jsx("span",{children:t.access_type})]}),e.jsx("a",{href:`#/gallery/${t.slug}`,target:"_blank",className:"inline-block mt-3 text-sm text-blue-400 hover:text-blue-300",children:"View Gallery â†’"})]},t.id))})]}),_==="orders"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Event Orders"}),e.jsx("p",{className:"text-sm text-gray-400",children:'Click "Link Match Card" to upload Smoothcomp screenshots'})]}),E.length===0?e.jsx("div",{className:"bg-gray-900/50 rounded-xl border border-gray-800 p-8 text-center text-gray-400",children:"No orders for this event yet."}):e.jsx("div",{className:"grid gap-4",children:E.map(t=>e.jsx("div",{className:"bg-gray-900/50 rounded-xl border border-gray-800 p-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:t.match_card_url?e.jsx("img",{src:t.match_card_url,alt:"Match Card",className:"w-24 h-32 object-cover rounded-lg cursor-pointer hover:opacity-80",onClick:()=>W(t)}):e.jsxs("button",{onClick:()=>W(t),className:"w-24 h-32 bg-gray-800 rounded-lg border-2 border-dashed border-gray-600 hover:border-red-500 flex flex-col items-center justify-center text-gray-500 hover:text-red-400 transition-colors",children:[e.jsx("svg",{className:"w-8 h-8 mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{className:"text-xs",children:"Add Card"})]})}),e.jsxs("div",{className:"flex-grow",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-lg",children:[t.first_name," ",t.last_name]}),e.jsx("p",{className:"text-sm text-gray-400",children:t.email})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-green-400",children:["$",t.amount]}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${t.status==="paid"?"bg-green-600":t.status==="pending"?"bg-yellow-600":"bg-gray-600"}`,children:t.status})]})]}),e.jsxs("div",{className:"mt-2 flex gap-4 text-sm text-gray-400",children:[e.jsx("span",{children:t.packages?.name}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:new Date(t.created_at).toLocaleDateString("en-AU")})]}),t.match_card_data&&Object.keys(t.match_card_data).length>0&&e.jsxs("div",{className:"mt-3 flex gap-3 flex-wrap",children:[t.match_card_data.mat&&e.jsxs("span",{className:"px-2 py-1 bg-blue-900/50 text-blue-300 rounded text-sm",children:["Mat ",t.match_card_data.mat]}),t.match_card_data.time&&e.jsx("span",{className:"px-2 py-1 bg-purple-900/50 text-purple-300 rounded text-sm",children:t.match_card_data.time}),t.match_card_data.division&&e.jsx("span",{className:"px-2 py-1 bg-green-900/50 text-green-300 rounded text-sm",children:t.match_card_data.division})]})]})]})},t.id))})]})]}),re&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-900 rounded-xl border border-gray-700 p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Import Athletes from Smoothcomp"}),e.jsxs("p",{className:"text-sm text-gray-400 mb-4",children:["Paste athlete data in this format (one per line):",e.jsx("br",{}),e.jsx("code",{className:"bg-gray-800 px-2 py-1 rounded text-xs",children:"Name | Division | Mat | Time | Academy"})]}),e.jsx("textarea",{value:V,onChange:t=>U(t.target.value),placeholder:"John Smith | Adult Blue Belt | 1 | 09:30 | Gracie Barra...",className:"w-full h-64 px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg font-mono text-sm"}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx("button",{onClick:()=>{R(!1),U("")},className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg",children:"Cancel"}),e.jsxs("button",{onClick:ve,className:"px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg",children:["Import ",z(V).length," Athletes"]})]})]})}),A&&m&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-900 rounded-xl border border-gray-700 p-6 w-full max-w-lg",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Link Match Card for ",m.first_name," ",m.last_name]}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Upload a screenshot of the athlete's Smoothcomp match card. We'll extract their mat number, competition time, and division automatically."}),m.match_card_url&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"Current Match Card:"}),e.jsx("img",{src:m.match_card_url,alt:"Current Match Card",className:"w-full max-h-64 object-contain rounded-lg border border-gray-700"}),m.match_card_data&&Object.keys(m.match_card_data).length>0&&e.jsxs("div",{className:"mt-2 flex gap-2 flex-wrap",children:[m.match_card_data.mat&&e.jsxs("span",{className:"px-2 py-1 bg-blue-900/50 text-blue-300 rounded text-sm",children:["Mat ",m.match_card_data.mat]}),m.match_card_data.time&&e.jsx("span",{className:"px-2 py-1 bg-purple-900/50 text-purple-300 rounded text-sm",children:m.match_card_data.time}),m.match_card_data.division&&e.jsx("span",{className:"px-2 py-1 bg-green-900/50 text-green-300 rounded text-sm",children:m.match_card_data.division})]})]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-600 rounded-lg p-6 text-center",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:t=>{const s=t.target.files?.[0];s&&me(s)},className:"hidden",id:"match-card-upload",disabled:B||$}),e.jsx("label",{htmlFor:"match-card-upload",className:`cursor-pointer ${B||$?"opacity-50":""}`,children:B?e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-red-500 border-t-transparent rounded-full"}),e.jsx("span",{className:"text-gray-400",children:"Uploading..."})]}):$?e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full"}),e.jsx("span",{className:"text-gray-400",children:"Extracting data with AI..."})]}):e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("svg",{className:"w-12 h-12 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsx("span",{className:"text-gray-400",children:"Click to upload or drag & drop"}),e.jsx("span",{className:"text-xs text-gray-500",children:"PNG, JPG up to 10MB"})]})})]}),e.jsx("div",{className:"flex justify-end gap-2 mt-4",children:e.jsx("button",{onClick:()=>{H(!1),K(null)},className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg",disabled:B||$,children:"Close"})})]})})]})}function ke(){const[f,te]=i.useState([]),[c,P]=i.useState(null),[_,ce]=i.useState([]),[J,se]=i.useState([]),[j,ae]=i.useState([]),[E,F]=i.useState([]),[O,oe]=i.useState([]),[Q,je]=i.useState([]),[y,T]=i.useState([]),[V,U]=i.useState(!0),[re,R]=i.useState(null),[N,le]=i.useState("events"),[L,ie]=i.useState(!1),[g,xe]=i.useState(null),[w,Y]=i.useState(null),[r,d]=i.useState({}),[A,H]=i.useState(null),[m,K]=i.useState([]),[B,G]=i.useState(!1),[$,ne]=i.useState([]),[D,z]=i.useState([]),X=new URLSearchParams(window.location.hash.split("?")[1]||"").get("org");i.useEffect(()=>{I()},[]),i.useEffect(()=>{c&&C(c.id)},[c]);async function I(){U(!0);const{data:t}=await l.from("organizations").select("*").order("name");if(te(t||[]),X&&t){const s=t.find(a=>a.id===X);s&&(P(s),window.location.hash.includes("galleries")&&le("galleries"))}U(!1)}async function C(t){const[s,a,n,o,u]=await Promise.all([l.from("events").select("*").eq("organization_id",t).order("date",{ascending:!0}),l.from("packages").select("*").eq("organization_id",t).order("sort_order"),l.from("content_orders").select("*, events(name), packages(name)").eq("organization_id",t).order("created_at",{ascending:!1}).limit(50),l.from("galleries").select("*, events(name), gallery_photos(count)").eq("organization_id",t).order("created_at",{ascending:!1}),l.from("gallery_purchases").select("*, galleries(title, slug, events(name))").eq("organization_id",t).order("created_at",{ascending:!1}).limit(100)]);ce(s.data||[]),se(a.data||[]),oe(n.data||[]),je(o.data||[]),T(u.data||[]);const x=(s.data||[]).map(p=>p.id);if(x.length>0){const[p,S]=await Promise.all([l.from("division_categories").select("*").in("event_id",x).order("sort_order"),l.from("division_subdivisions").select("*").order("sort_order")]);ae(p.data||[]);const b=(p.data||[]).map(h=>h.id);F((S.data||[]).filter(h=>b.includes(h.category_id)))}else ae([]),F([])}async function me(){const{data:t,error:s}=await l.from("packages").select("*, organizations(name, display_name)").neq("organization_id",c?.id).order("name");!s&&t&&ne(t)}async function ge(){if(D.length===0||!c)return;const s=$.filter(n=>D.includes(n.id)).map(n=>({name:n.name,description:n.description,price:n.price,sort_order:n.sort_order,active:n.active,organization_id:c.id})),{error:a}=await l.from("packages").insert(s);a?alert("Failed to import packages: "+a.message):(G(!1),z([]),C(c.id))}function Z(t){return j.filter(s=>s.event_id===t)}function W(t){return E.filter(s=>s.category_id===t)}function k(t,s=null,a=null){xe(t),Y(s),t==="org"?d(s||{name:"",display_name:"",legal_name:"",slug:"",description:"",logo_url:"",active:!0}):t==="event"?d(s||{organization_id:c?.id,name:"",date:"",location:"",status:"upcoming",active:!0,divisions_required:!1}):t==="package"?d(s||{organization_id:c?.id,name:"",description:"",price:"",sort_order:0,active:!0}):t==="division-cat"?d(s||{event_id:a||A,name:"",sort_order:0,active:!0}):t==="division-sub"&&d(s||{category_id:a,name:"",sort_order:0,active:!0}),ie(!0)}async function he(){try{if(g==="org")w?.id?await l.from("organizations").update(r).eq("id",w.id):await l.from("organizations").insert(r),I();else if(g==="event"){const t={...r,organization_id:c.id};w?.id?await l.from("events").update(t).eq("id",w.id):await l.from("events").insert(t),C(c.id)}else if(g==="package"){const t={...r,organization_id:c.id,price:parseFloat(r.price)};w?.id?await l.from("packages").update(t).eq("id",w.id):await l.from("packages").insert(t),C(c.id)}else g==="division-cat"?(w?.id?await l.from("division_categories").update(r).eq("id",w.id):await l.from("division_categories").insert(r),C(c.id)):g==="division-sub"&&(w?.id?await l.from("division_subdivisions").update(r).eq("id",w.id):await l.from("division_subdivisions").insert(r),C(c.id));ie(!1)}catch(t){console.error("Save error:",t),alert("Error saving. Check console.")}}async function q(t,s){if(t==="organizations"){await ee(s);return}if(!confirm("Are you sure you want to delete this item?"))return;const{error:a}=await l.from(t).delete().eq("id",s);if(a){console.error("Delete error:",a),alert(`Failed to delete: ${a.message}`);return}C(c.id)}async function ee(t){const s=f.find(v=>v.id===t);if(!s)return;const[a,n,o,u]=await Promise.all([l.from("events").select("id, name").eq("organization_id",t),l.from("packages").select("id, name").eq("organization_id",t),l.from("content_orders").select("id").eq("organization_id",t),l.from("livestream_events").select("id, title").eq("organization_id",t)]),x=a.data||[],p=n.data||[],S=o.data||[],b=u.data||[];let h=`âš ï¸ DELETE "${s.display_name||s.name}"?

This will also delete:
`;if(x.length>0&&(h+=`
ðŸ“… ${x.length} event${x.length>1?"s":""}`,x.slice(0,3).forEach(v=>{h+=`
   â€¢ ${v.name}`}),x.length>3&&(h+=`
   â€¢ ...and ${x.length-3} more`)),p.length>0&&(h+=`

ðŸ“¦ ${p.length} package${p.length>1?"s":""}`,p.slice(0,3).forEach(v=>{h+=`
   â€¢ ${v.name}`}),p.length>3&&(h+=`
   â€¢ ...and ${p.length-3} more`)),b.length>0&&(h+=`

ðŸŽ¬ ${b.length} livestream event${b.length>1?"s":""}`,b.slice(0,3).forEach(v=>{h+=`
   â€¢ ${v.title}`}),b.length>3&&(h+=`
   â€¢ ...and ${b.length-3} more`)),S.length>0&&(h+=`

ðŸ§¾ ${S.length} order${S.length>1?"s":""}`),x.length+p.length+S.length+b.length===0?h=`Delete "${s.display_name||s.name}"?

No related items will be affected.`:h+=`

âš ï¸ THIS CANNOT BE UNDONE!`,!!confirm(h))try{S.length>0&&await l.from("content_orders").delete().eq("organization_id",t),p.length>0&&await l.from("packages").delete().eq("organization_id",t);for(const ue of x){const{data:be}=await l.from("division_categories").select("id").eq("event_id",ue.id);if(be&&be.length>0){for(const fe of be)await l.from("division_subdivisions").delete().eq("category_id",fe.id);await l.from("division_categories").delete().eq("event_id",ue.id)}await l.from("events").delete().eq("id",ue.id)}b.length>0&&await l.from("livestream_events").update({organization_id:null}).eq("organization_id",t);const{error:v}=await l.from("organizations").delete().eq("id",t);if(v)throw v;I(),c?.id===t&&P(null)}catch(v){console.error("Cascade delete error:",v),alert(`Failed to delete: ${v.message}`)}}async function M(t,s,a){await l.from(t).update({active:!a}).eq("id",s),t==="organizations"?I():C(c.id)}if(V)return e.jsx("div",{className:"p-8 text-gray-400",children:"Loading..."});if(!c)return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Content Management"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Select an organization to manage its events, packages, and divisions"})]}),e.jsx("button",{onClick:()=>k("org"),className:"px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm font-medium",children:"+ Add Organization"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:f.map(t=>e.jsxs("div",{onClick:()=>P(t),className:"bg-gray-900/50 rounded-xl border border-gray-800 p-6 cursor-pointer hover:border-red-500/50 hover:bg-gray-900/80 transition-all group",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[t.logo_url?e.jsx("img",{src:ye(t.logo_url),alt:t.name,className:"w-12 h-12 rounded-lg object-cover"}):e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-red-600 to-red-800 flex items-center justify-center text-xl font-bold",children:t.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg group-hover:text-red-400 transition-colors",children:t.display_name||t.name}),t.display_name&&t.display_name!==t.name&&e.jsx("p",{className:"text-xs text-gray-400",children:t.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:["/",t.slug]})]})]}),!t.active&&e.jsx("span",{className:"text-xs bg-gray-700 px-2 py-1 rounded",children:"Inactive"})]}),t.description&&e.jsx("p",{className:"text-sm text-gray-400 line-clamp-2",children:t.description}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{onClick:s=>{s.stopPropagation(),k("org",t)},className:"text-xs text-blue-400 hover:text-blue-300",children:"Edit"}),e.jsx("button",{onClick:s=>{s.stopPropagation(),M("organizations",t.id,t.active)},className:"text-xs text-gray-400 hover:text-white",children:t.active?"Deactivate":"Activate"}),e.jsx("button",{onClick:s=>{s.stopPropagation(),q("organizations",t.id)},className:"text-xs text-red-400 hover:text-red-300",children:"Delete"})]})]},t.id))}),L&&de()]});if(re)return e.jsx("div",{className:"p-6",children:e.jsx(Ne,{event:re,organization:c,onBack:()=>R(null),onEventUpdate:()=>C(c.id)})});return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:()=>P(null),className:"text-gray-400 hover:text-white transition-colors",children:"â† Back"}),e.jsxs("div",{className:"flex items-center gap-3",children:[c.logo_url?e.jsx("img",{src:ye(c.logo_url),alt:c.name,className:"w-10 h-10 rounded-lg object-cover"}):e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-red-600 to-red-800 flex items-center justify-center text-lg font-bold",children:c.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:c.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:["/",c.slug]})]})]})]}),e.jsx("div",{className:"flex gap-2 mb-6 border-b border-gray-700 pb-2 overflow-x-auto",children:["events","packages","divisions","galleries","gallery-orders","orders"].map(t=>e.jsxs("button",{onClick:()=>le(t),className:`px-4 py-2 rounded-t-lg capitalize transition-colors whitespace-nowrap ${N===t?"bg-red-600 text-white":"text-gray-400 hover:text-white"}`,children:[t==="gallery-orders"?"Gallery Orders":t," ",t==="events"&&`(${_.length})`,t==="packages"&&`(${J.length})`,t==="galleries"&&`(${Q.length})`,t==="gallery-orders"&&`(${y.length})`,t==="orders"&&`(${O.length})`]},t))}),N==="events"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Upcoming Events"}),e.jsx("button",{onClick:()=>k("event"),className:"px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm",children:"+ Add Event"})]}),_.length===0?e.jsx("div",{className:"bg-gray-900/50 rounded-xl border border-gray-800 p-8 text-center text-gray-400",children:"No events yet. Add one to get started."}):e.jsx("div",{className:"bg-gray-900/50 rounded-xl border border-gray-800 overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3",children:"Event Name"}),e.jsx("th",{className:"text-left p-3",children:"Date"}),e.jsx("th",{className:"text-left p-3",children:"Location"}),e.jsx("th",{className:"text-center p-3",children:"Status"}),e.jsx("th",{className:"text-center p-3",children:"Active"}),e.jsx("th",{className:"text-right p-3",children:"Actions"})]})}),e.jsx("tbody",{children:_.map(t=>e.jsxs("tr",{className:"border-t border-gray-800 hover:bg-gray-800/50 cursor-pointer transition-colors",onClick:()=>R(t),children:[e.jsx("td",{className:"p-3 font-medium text-blue-400 hover:text-blue-300",children:t.name}),e.jsx("td",{className:"p-3 text-gray-400",children:t.date&&new Date(t.date).toLocaleDateString("en-AU",{weekday:"short",day:"numeric",month:"short",year:"numeric"})}),e.jsx("td",{className:"p-3 text-gray-400",children:t.location}),e.jsx("td",{className:"p-3 text-center",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${t.status==="upcoming"?"bg-blue-600":t.status==="active"?"bg-green-600":"bg-gray-600"}`,children:t.status})}),e.jsx("td",{className:"p-3 text-center",onClick:s=>s.stopPropagation(),children:e.jsx("button",{onClick:()=>M("events",t.id,t.active),className:`px-2 py-1 rounded text-xs ${t.active?"bg-green-600":"bg-gray-600"}`,children:t.active?"Yes":"No"})}),e.jsxs("td",{className:"p-3 text-right space-x-2",onClick:s=>s.stopPropagation(),children:[e.jsx("button",{onClick:()=>k("event",t),className:"text-blue-400 hover:text-blue-300",children:"Edit"}),e.jsx("button",{onClick:()=>q("events",t.id),className:"text-red-400 hover:text-red-300",children:"Delete"})]})]},t.id))})]})})]}),N==="packages"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Content Packages"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{me(),G(!0)},className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm",children:"Import from..."}),e.jsx("button",{onClick:()=>k("package"),className:"px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm",children:"+ Add Package"})]})]}),J.length===0?e.jsx("div",{className:"bg-gray-900/50 rounded-xl border border-gray-800 p-8 text-center text-gray-400",children:"No packages yet. Add one to get started, or import from another organization."}):e.jsx("div",{className:"bg-gray-900/50 rounded-xl border border-gray-800 overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3",children:"Package Name"}),e.jsx("th",{className:"text-left p-3",children:"Description"}),e.jsx("th",{className:"text-right p-3",children:"Price"}),e.jsx("th",{className:"text-center p-3",children:"Active"}),e.jsx("th",{className:"text-right p-3",children:"Actions"})]})}),e.jsx("tbody",{children:J.map(t=>e.jsxs("tr",{className:"border-t border-gray-800",children:[e.jsx("td",{className:"p-3 font-medium",children:t.name}),e.jsx("td",{className:"p-3 text-gray-400 truncate max-w-xs",children:t.description}),e.jsxs("td",{className:"p-3 text-right font-semibold text-green-400",children:["$",t.price]}),e.jsx("td",{className:"p-3 text-center",children:e.jsx("button",{onClick:()=>M("packages",t.id,t.active),className:`px-2 py-1 rounded text-xs ${t.active?"bg-green-600":"bg-gray-600"}`,children:t.active?"Yes":"No"})}),e.jsxs("td",{className:"p-3 text-right space-x-2",children:[e.jsx("button",{onClick:()=>k("package",t),className:"text-blue-400 hover:text-blue-300",children:"Edit"}),e.jsx("button",{onClick:()=>q("packages",t.id),className:"text-red-400 hover:text-red-300",children:"Delete"})]})]},t.id))})]})})]}),N==="divisions"&&e.jsx("div",{children:e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Divisions by Event"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Select an event to manage its division categories and subdivisions"}),_.length===0?e.jsx("div",{className:"bg-gray-900/50 rounded-xl border border-gray-800 p-8 text-center text-gray-400",children:"Add events first, then you can manage their divisions."}):e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:A||"",onChange:t=>H(t.target.value),className:"w-full max-w-md px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg",children:[e.jsx("option",{value:"",children:"Select an event..."}),_.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.date&&new Date(t.date).toLocaleDateString("en-AU"),")"]},t.id))]}),A&&e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Division Categories (",Z(A).length,")"]}),e.jsx("button",{onClick:()=>k("division-cat",null,A),className:"px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm",children:"+ Add Category"})]}),Z(A).length===0?e.jsx("div",{className:"bg-gray-900/50 rounded-xl border border-gray-800 p-8 text-center text-gray-400",children:"No division categories for this event yet."}):e.jsx("div",{className:"space-y-3",children:Z(A).map(t=>e.jsxs("div",{className:"bg-gray-900/50 rounded-xl border border-gray-800 overflow-hidden",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center bg-gray-800/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>K(s=>s.includes(t.id)?s.filter(a=>a!==t.id):[...s,t.id]),className:"text-gray-400 hover:text-white",children:e.jsx("svg",{className:`w-5 h-5 transition-transform ${m.includes(t.id)?"rotate-90":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),e.jsx("span",{className:"font-semibold",children:t.name}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",W(t.id).length," subdivisions)"]}),!t.active&&e.jsx("span",{className:"text-xs bg-gray-600 px-2 py-0.5 rounded",children:"Inactive"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>k("division-cat",t),className:"text-blue-400 hover:text-blue-300 text-sm",children:"Edit"}),e.jsx("button",{onClick:()=>q("division_categories",t.id),className:"text-red-400 hover:text-red-300 text-sm",children:"Delete"})]})]}),m.includes(t.id)&&e.jsxs("div",{className:"p-4 border-t border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Subdivisions:"}),e.jsx("button",{onClick:()=>k("division-sub",null,t.id),className:"text-sm text-green-400 hover:text-green-300",children:"+ Add Subdivision"})]}),W(t.id).length===0?e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No subdivisions yet"}):e.jsx("div",{className:"flex flex-wrap gap-2",children:W(t.id).map(s=>e.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-1.5 rounded-lg border text-sm ${s.active?"bg-gray-800 border-gray-600":"bg-gray-900 border-gray-700 opacity-50"}`,children:[e.jsx("span",{children:s.name}),e.jsx("button",{onClick:()=>k("division-sub",s,t.id),className:"text-blue-400 hover:text-blue-300",children:"âœŽ"}),e.jsx("button",{onClick:()=>q("division_subdivisions",s.id),className:"text-red-400 hover:text-red-300",children:"Ã—"})]},s.id))})]})]},t.id))}),c.slug==="nba"&&e.jsxs("div",{className:"mt-6 p-4 bg-blue-900/20 border border-blue-800 rounded-xl",children:[e.jsx("h4",{className:"font-semibold text-blue-400 mb-2",children:"Quick Add: Standard NBA Divisions"}),e.jsx("p",{className:"text-sm text-gray-400 mb-3",children:"Add all standard NBA bodybuilding divisions for this event"}),e.jsx("button",{onClick:async t=>{const s=t.target,a=s.innerText;if(!A){alert("Please select an event first");return}if(window.confirm("Add all standard NBA divisions to this event?")){s.disabled=!0,s.innerText="Adding divisions...";try{const n={"Men's Physique":["Novice","Open","Masters 40+","Masters 50+","Junior"],"Classic Physique":["Novice","Open","Masters 40+","Masters 50+"],Bodybuilding:["Novice","Open","Masters 40+","Masters 50+","Junior"],Figure:["Novice","Open","Masters 35+","Masters 45+","Junior"],Bikini:["Novice","Open","Masters 35+","Masters 45+","Junior"],Wellness:["Novice","Open","Masters 35+","Masters 45+"],"Fitness Model":["Open","Masters"],"Sports Model":["Open","Masters"],Transformation:["Open"]};let o=0,u=0;for(const[x,p]of Object.entries(n)){const{data:S,error:b}=await l.from("division_categories").insert({event_id:A,name:x,sort_order:o++,active:!0}).select().single();if(b){console.error("Error adding category:",x,b);continue}if(S){u++;let h=0;for(const pe of p){const{error:v}=await l.from("division_subdivisions").insert({category_id:S.id,name:pe,sort_order:h++,active:!0});v&&console.error("Error adding subdivision:",pe,v)}}}alert(`Added ${u} division categories with subdivisions!`),await C(c.id)}catch(n){console.error("Error adding divisions:",n),alert("Error adding divisions: "+n.message)}finally{s.disabled=!1,s.innerText=a}}},className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm disabled:opacity-50",children:"Add Standard NBA Divisions"})]})]})]})]})}),N==="galleries"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Photo Galleries"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("a",{href:`/#/portal/galleries?org=${c.id}&create=true`,className:"px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm",children:"+ New Gallery"}),Q.length>0&&e.jsx("a",{href:`/#/portal/galleries?org=${c.id}`,className:"px-4 py-2 bg-dark-600 hover:bg-dark-500 rounded-lg text-sm",children:"Manage All"})]})]}),Q.length===0?e.jsx("div",{className:"bg-gray-900/50 rounded-xl border border-gray-800 p-8 text-center text-gray-400",children:"No galleries yet. Create one to start selling event photos."}):e.jsx("div",{className:"bg-gray-900/50 rounded-xl border border-gray-800 overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3",children:"Gallery Name"}),e.jsx("th",{className:"text-left p-3",children:"Event"}),e.jsx("th",{className:"text-center p-3",children:"Photos"}),e.jsx("th",{className:"text-right p-3",children:"Price/Photo"}),e.jsx("th",{className:"text-center p-3",children:"Status"}),e.jsx("th",{className:"text-right p-3",children:"Actions"})]})}),e.jsx("tbody",{children:Q.map(t=>e.jsxs("tr",{className:"border-t border-gray-800",children:[e.jsx("td",{className:"p-3 font-medium",children:t.title}),e.jsx("td",{className:"p-3 text-gray-400",children:t.events?.name||"â€”"}),e.jsx("td",{className:"p-3 text-center",children:t.gallery_photos?.[0]?.count||0}),e.jsxs("td",{className:"p-3 text-right font-semibold text-green-400",children:["$",(t.price_per_photo/100).toFixed(2)]}),e.jsx("td",{className:"p-3 text-center",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${t.status==="published"?"bg-green-600":t.status==="draft"?"bg-yellow-600":"bg-gray-600"}`,children:t.status})}),e.jsxs("td",{className:"p-3 text-right space-x-2",children:[e.jsx("a",{href:`/#/portal/galleries?edit=${t.id}`,className:"text-blue-400 hover:text-blue-300",children:"Edit"}),t.status==="published"&&e.jsx("a",{href:`/#/gallery/${t.slug}`,target:"_blank",className:"text-green-400 hover:text-green-300",children:"View"})]})]},t.id))})]})})]}),N==="gallery-orders"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Gallery Photo Orders"}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Total Revenue: ",e.jsxs("span",{className:"text-green-400 font-semibold",children:["$",y.reduce((t,s)=>t+(s.amount||0),0).toFixed(2)]})]})]}),y.length===0?e.jsx("div",{className:"bg-gray-900/50 rounded-xl border border-gray-800 p-8 text-center text-gray-400",children:"No gallery orders yet. Orders will appear here when customers purchase photos."}):e.jsx("div",{className:"bg-gray-900/50 rounded-xl border border-gray-800 overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3",children:"Date"}),e.jsx("th",{className:"text-left p-3",children:"Customer"}),e.jsx("th",{className:"text-left p-3",children:"Gallery"}),e.jsx("th",{className:"text-left p-3",children:"Event"}),e.jsx("th",{className:"text-center p-3",children:"Photos"}),e.jsx("th",{className:"text-right p-3",children:"Amount"}),e.jsx("th",{className:"text-center p-3",children:"Status"}),e.jsx("th",{className:"text-right p-3",children:"Actions"})]})}),e.jsx("tbody",{children:y.map(t=>e.jsxs("tr",{className:"border-t border-gray-800",children:[e.jsxs("td",{className:"p-3 text-gray-400",children:[new Date(t.created_at).toLocaleDateString("en-AU"),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(t.created_at).toLocaleTimeString("en-AU",{hour:"2-digit",minute:"2-digit"})})]}),e.jsxs("td",{className:"p-3",children:[e.jsx("div",{className:"font-medium",children:t.customer_name||"N/A"}),e.jsx("div",{className:"text-xs text-gray-500",children:t.customer_email})]}),e.jsx("td",{className:"p-3 text-gray-400",children:t.galleries?.title||"N/A"}),e.jsx("td",{className:"p-3 text-gray-400",children:t.galleries?.events?.name||"â€”"}),e.jsx("td",{className:"p-3 text-center",children:t.photo_count||1}),e.jsxs("td",{className:"p-3 text-right font-semibold text-green-400",children:["$",(t.amount||0).toFixed(2)]}),e.jsx("td",{className:"p-3 text-center",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${t.status==="completed"||t.status==="paid"?"bg-green-600":t.status==="pending"?"bg-yellow-600":"bg-gray-600"}`,children:t.status||"pending"})}),e.jsx("td",{className:"p-3 text-right",children:t.galleries?.slug&&e.jsx("a",{href:`/#/gallery/${t.galleries.slug}`,target:"_blank",className:"text-blue-400 hover:text-blue-300 text-sm",children:"View Gallery"})})]},t.id))})]})})]}),N==="orders"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Recent Orders"}),e.jsx("div",{className:"bg-gray-900/50 rounded-xl border border-gray-800 overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3",children:"Date"}),e.jsx("th",{className:"text-left p-3",children:"Athlete"}),e.jsx("th",{className:"text-left p-3",children:"Email"}),e.jsx("th",{className:"text-left p-3",children:"Event"}),e.jsx("th",{className:"text-left p-3",children:"Package"}),e.jsx("th",{className:"text-right p-3",children:"Amount"}),e.jsx("th",{className:"text-center p-3",children:"Status"})]})}),e.jsx("tbody",{children:O.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"p-8 text-center text-gray-400",children:"No orders yet"})}):O.map(t=>e.jsxs("tr",{className:"border-t border-gray-800",children:[e.jsx("td",{className:"p-3 text-gray-400",children:new Date(t.created_at).toLocaleDateString("en-AU")}),e.jsxs("td",{className:"p-3 font-medium",children:[t.first_name," ",t.last_name]}),e.jsx("td",{className:"p-3 text-gray-400",children:t.email}),e.jsx("td",{className:"p-3 text-gray-400",children:t.events?.name}),e.jsx("td",{className:"p-3 text-gray-400",children:t.packages?.name}),e.jsxs("td",{className:"p-3 text-right font-semibold",children:["$",t.amount]}),e.jsx("td",{className:"p-3 text-center",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${t.status==="paid"?"bg-green-600":t.status==="delivered"?"bg-blue-600":t.status==="pending"?"bg-yellow-600":"bg-gray-600"}`,children:t.status})})]},t.id))})]})})]}),L&&de(),B&&e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-900 rounded-xl border border-gray-700 p-6 w-full max-w-lg max-h-[80vh] overflow-hidden flex flex-col",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Import Packages from Other Organizations"}),$.length===0?e.jsx("p",{className:"text-gray-400 text-center py-8",children:"No packages available to import from other organizations."}):e.jsx("div",{className:"flex-1 overflow-y-auto mb-4 space-y-2",children:Object.entries($.reduce((t,s)=>{const a=s.organizations?.display_name||s.organizations?.name||"Unknown";return t[a]||(t[a]=[]),t[a].push(s),t},{})).map(([t,s])=>e.jsxs("div",{className:"border border-gray-700 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gray-800 px-3 py-2 font-medium text-sm",children:t}),e.jsx("div",{className:"divide-y divide-gray-800",children:s.map(a=>e.jsxs("label",{className:"flex items-center gap-3 px-3 py-2 hover:bg-gray-800/50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:D.includes(a.id),onChange:n=>{n.target.checked?z(o=>[...o,a.id]):z(o=>o.filter(u=>u!==a.id))},className:"w-4 h-4 rounded"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:a.name}),a.description&&e.jsx("div",{className:"text-xs text-gray-400 truncate",children:a.description})]}),e.jsxs("div",{className:"text-green-400 font-semibold",children:["$",a.price]})]},a.id))})]},t))}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-700",children:[e.jsx("button",{onClick:()=>{G(!1),z([])},className:"flex-1 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg",children:"Cancel"}),e.jsxs("button",{onClick:ge,disabled:D.length===0,className:"flex-1 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed",children:["Import ",D.length>0&&`(${D.length})`]})]})]})})]});function de(){return e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-900 rounded-xl border border-gray-700 p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:[w?"Edit":"Add"," ",g==="org"?"Organization":g==="event"?"Event":g==="package"?"Package":g==="division-cat"?"Division Category":g==="division-sub"?"Subdivision":""]}),e.jsxs("div",{className:"space-y-4",children:[g==="org"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Organization Name *"}),e.jsx("input",{type:"text",value:r.name||"",onChange:t=>d({...r,name:t.target.value}),placeholder:"e.g., World Ninja Games",className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Display Name (Short)"}),e.jsx("input",{type:"text",value:r.display_name||"",onChange:t=>d({...r,display_name:t.target.value}),placeholder:"e.g., WNG",className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Shown on livestream cards & filters"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Legal Name"}),e.jsx("input",{type:"text",value:r.legal_name||"",onChange:t=>d({...r,legal_name:t.target.value}),placeholder:"e.g., World Ninja Games Pty Ltd",className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"For contracts & invoices"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Slug (URL-friendly)"}),e.jsx("input",{type:"text",value:r.slug||"",onChange:t=>d({...r,slug:t.target.value.toLowerCase().replace(/\s+/g,"-")}),className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Logo URL"}),e.jsx("input",{type:"text",value:r.logo_url||"",onChange:t=>d({...r,logo_url:t.target.value}),placeholder:"https://...",className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Description"}),e.jsx("textarea",{value:r.description||"",onChange:t=>d({...r,description:t.target.value}),className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg",rows:3})]}),e.jsxs("div",{className:"border-t border-gray-700 pt-4 mt-4",children:[e.jsx("p",{className:"text-sm text-gray-400 mb-3 font-medium",children:"Contact / Organizer"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Contact Name"}),e.jsx("input",{type:"text",value:r.contact_name||"",onChange:t=>d({...r,contact_name:t.target.value}),placeholder:"e.g., Phil Cassidy",className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Contact Email"}),e.jsx("input",{type:"email",value:r.contact_email||"",onChange:t=>d({...r,contact_email:t.target.value}),placeholder:"email@example.com",className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Contact Phone"}),e.jsx("input",{type:"tel",value:r.contact_phone||"",onChange:t=>d({...r,contact_phone:t.target.value}),placeholder:"+61 400 000 000",className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg"})]})]})]})]})]}),g==="event"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Event Name"}),e.jsx("input",{type:"text",value:r.name||"",onChange:t=>d({...r,name:t.target.value}),className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Date"}),e.jsx("input",{type:"date",value:r.date||"",onChange:t=>d({...r,date:t.target.value}),className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Location"}),e.jsx("input",{type:"text",value:r.location||"",onChange:t=>d({...r,location:t.target.value}),className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Status"}),e.jsxs("select",{value:r.status||"upcoming",onChange:t=>d({...r,status:t.target.value}),className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg",children:[e.jsx("option",{value:"upcoming",children:"Upcoming"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"completed",children:"Completed"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.divisions_required||!1,onChange:t=>d({...r,divisions_required:t.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-600"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-white",children:"Require Divisions"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Athletes must select a division when ordering"})]})]})]}),g==="package"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Package Name"}),e.jsx("input",{type:"text",value:r.name||"",onChange:t=>d({...r,name:t.target.value}),className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Description"}),e.jsx("input",{type:"text",value:r.description||"",onChange:t=>d({...r,description:t.target.value}),className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Price (AUD)"}),e.jsx("input",{type:"number",value:r.price||"",onChange:t=>d({...r,price:t.target.value}),className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Sort Order"}),e.jsx("input",{type:"number",value:r.sort_order||0,onChange:t=>d({...r,sort_order:parseInt(t.target.value)}),className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg"})]})]})]}),g==="division-cat"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Category Name"}),e.jsx("input",{type:"text",value:r.name||"",onChange:t=>d({...r,name:t.target.value}),placeholder:"e.g., Men's Physique, Bikini, Figure",className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Sort Order"}),e.jsx("input",{type:"number",value:r.sort_order||0,onChange:t=>d({...r,sort_order:parseInt(t.target.value)}),className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg"})]})]}),g==="division-sub"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Subdivision Name"}),e.jsx("input",{type:"text",value:r.name||"",onChange:t=>d({...r,name:t.target.value}),placeholder:"e.g., Novice, Open, Masters 40+",className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Sort Order"}),e.jsx("input",{type:"number",value:r.sort_order||0,onChange:t=>d({...r,sort_order:parseInt(t.target.value)}),className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"active",checked:r.active??!0,onChange:t=>d({...r,active:t.target.checked}),className:"rounded"}),e.jsx("label",{htmlFor:"active",className:"text-sm text-gray-400",children:"Active"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>ie(!1),className:"flex-1 py-2 border border-gray-600 rounded-lg hover:bg-gray-800",children:"Cancel"}),e.jsx("button",{onClick:he,className:"flex-1 py-2 bg-red-600 hover:bg-red-700 rounded-lg",children:"Save"})]})]})})}}export{ke as default};
