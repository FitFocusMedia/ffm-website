import{o as R,n as W,p as N,q as Y,j as e,r as v,i as k,v as q,I as z,k as _,D,h as B,m as V,M as H,P as J,w as K,x as Q}from"./index-B7o4PSF_.js";import{h as X,e as Z,b as r}from"./vendor-react-q0iRXJvs.js";import{L as ee}from"./log-out-DSEbbOXM.js";import"./vendor-supabase-DhDedaeW.js";function le(){const n=X();Z();const[d,c]=r.useState(null),[u,m]=r.useState([]),[S,P]=r.useState(!0),[i,E]=r.useState(""),[g,p]=r.useState(!1),[C,f]=r.useState(!1),[b,x]=r.useState(null);r.useEffect(()=>{L();const{data:{subscription:s}}=R(async(t,a)=>{if(t==="SIGNED_IN"&&a?.user){c(a.user);try{await N(a.user.id,a.user.email)}catch(l){console.error("Failed to sync profile:",l)}j(a.user.email),(window.location.hash.includes("access_token")||window.location.hash==="#"||window.location.hash==="#/")&&n("/my-purchases",{replace:!0})}else t==="SIGNED_OUT"&&(c(null),m([]))});return()=>s.unsubscribe()},[n]);const L=async()=>{try{const s=await W();if(s?.user){c(s.user);try{await N(s.user.id,s.user.email)}catch(t){console.error("Failed to sync profile:",t)}await j(s.user.email)}}catch(s){console.error("Auth check failed:",s)}finally{P(!1)}},j=async s=>{try{const t=await Y(s);m(t||[])}catch(t){console.error("Failed to load purchases:",t),x("Failed to load your purchases")}},U=async s=>{if(s.preventDefault(),!!i){p(!0),x(null);try{await K(i,window.location.origin),f(!0)}catch(t){const a=t?.message||t?.error_description||"Unknown error";x(`Failed to send login link: ${a}`),console.error("Magic link error:",t)}finally{p(!1)}}},A=async()=>{await Q(),c(null),m([])},h=s=>new Date(s).toLocaleDateString("en-AU",{weekday:"short",day:"numeric",month:"short",year:"numeric"}),M=s=>new Date(s).toLocaleTimeString("en-AU",{hour:"2-digit",minute:"2-digit"}),$=s=>{const t=new Date,a=new Date(s.start_time),l=new Date(s.end_time);return t>=a&&t<=l&&s.is_live},F=s=>new Date(s.start_time)>new Date,I=s=>new Date(s.end_time)<new Date;return S?e.jsx("div",{className:"min-h-screen bg-dark-950 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-500"})}):d?e.jsx("div",{className:"min-h-screen bg-dark-950",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"My Purchases"}),e.jsx("p",{className:"text-gray-400",children:d.email})]}),e.jsxs("button",{onClick:A,className:"flex items-center gap-2 px-4 py-2 text-gray-400 hover:text-white transition-colors",children:[e.jsx(ee,{className:"w-5 h-5"}),"Sign Out"]})]}),u.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(v,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-white mb-2",children:"No Purchases Yet"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"You haven't purchased any events or photos yet."}),e.jsx("button",{onClick:()=>n("/live"),className:"px-6 py-3 bg-red-500 hover:bg-red-600 text-white font-semibold rounded-lg transition-colors",children:"Browse Events"})]}):e.jsx("div",{className:"space-y-4",children:u.map(s=>{if(s.type==="gallery"){const O=s.gallery,T=s.is_package,y=s.photoCount||0,G=`/gallery/download/${s.download_token}`,o=s.token_expires_at&&new Date(s.token_expires_at)<new Date;return e.jsx("div",{className:"bg-dark-900 rounded-xl border border-dark-800 overflow-hidden hover:border-dark-700 transition-colors",children:e.jsxs("div",{className:"flex flex-col md:flex-row",children:[e.jsx("div",{className:"md:w-48 h-32 md:h-auto flex-shrink-0 bg-gradient-to-br from-purple-900/50 to-pink-900/50 flex items-center justify-center",children:e.jsx(q,{className:"w-16 h-16 text-purple-400/60"})}),e.jsxs("div",{className:"flex-1 p-5",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:O?.title||"Photo Gallery"}),e.jsxs("span",{className:"px-2 py-0.5 bg-purple-500/20 text-purple-400 text-xs font-medium rounded-full flex items-center gap-1",children:[e.jsx(z,{className:"w-3 h-3"}),"Photos"]})]}),e.jsx("p",{className:"text-gray-400 text-sm mb-3",children:T?"Full Gallery Package":`${y} photo${y!==1?"s":""}`}),e.jsx("div",{className:"flex flex-wrap gap-4 text-sm text-gray-500",children:o?e.jsxs("div",{className:"flex items-center gap-1 text-amber-500",children:[e.jsx(_,{className:"w-4 h-4"}),"Download link expired"]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(D,{className:"w-4 h-4"}),"Download available"]})})]}),e.jsxs("button",{onClick:()=>n(G),disabled:o,className:`flex items-center justify-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors w-full sm:w-auto ${o?"bg-dark-700 text-gray-500 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700 text-white"}`,children:[e.jsx(D,{className:"w-5 h-5"}),o?"Expired":"Download"]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-dark-800 flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:["Purchased ",h(s.created_at)]}),e.jsxs("span",{className:"text-green-500 font-medium",children:["$",(s.total_amount/100).toFixed(2)," AUD"]})]})]})]})},s.id)}const t=s.event;if(!t)return null;const a=$(t),l=F(t),w=I(t);return e.jsx("div",{className:"bg-dark-900 rounded-xl border border-dark-800 overflow-hidden hover:border-dark-700 transition-colors",children:e.jsxs("div",{className:"flex flex-col md:flex-row",children:[t.thumbnail_url&&e.jsx("div",{className:"md:w-48 h-32 md:h-auto flex-shrink-0",children:e.jsx("img",{src:B(t.thumbnail_url),alt:t.title,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 p-5",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:t.title}),a&&e.jsxs("span",{className:"px-2 py-0.5 bg-red-500 text-white text-xs font-bold rounded-full flex items-center gap-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-white rounded-full animate-pulse"}),"LIVE"]}),l&&e.jsx("span",{className:"px-2 py-0.5 bg-blue-500/20 text-blue-400 text-xs font-medium rounded-full",children:"Upcoming"}),w&&!t.mux_playback_id&&e.jsx("span",{className:"px-2 py-0.5 bg-gray-500/20 text-gray-400 text-xs font-medium rounded-full",children:"Ended"}),w&&t.mux_playback_id&&e.jsx("span",{className:"px-2 py-0.5 bg-green-500/20 text-green-400 text-xs font-medium rounded-full",children:"Replay Available"})]}),e.jsx("p",{className:"text-gray-400 text-sm mb-3",children:t.org_display_name||t.organization}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(V,{className:"w-4 h-4"}),h(t.start_time)]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_,{className:"w-4 h-4"}),M(t.start_time)]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(H,{className:"w-4 h-4"}),t.venue]})]})]}),(a||l||t.mux_playback_id)&&e.jsxs("button",{onClick:()=>n(`/watch/${t.id}?email=${encodeURIComponent(d.email)}`),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors flex-shrink-0 ${a?"bg-red-500 hover:bg-red-600 text-white":"bg-dark-800 hover:bg-dark-700 text-white"}`,children:[e.jsx(J,{className:"w-5 h-5"}),a?"Watch Live":l?"Watch":"Replay"]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-dark-800 flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:["Purchased ",h(s.created_at)]}),e.jsxs("span",{className:"text-green-500 font-medium",children:["$",s.amount," AUD"]})]})]})]})},s.id)})})]})}):e.jsx("div",{className:"min-h-screen bg-dark-950 flex items-center justify-center px-4",children:e.jsxs("div",{className:"max-w-md w-full",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx(v,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"My Purchases"}),e.jsx("p",{className:"text-gray-400",children:"Enter your email to access your purchased events"})]}),C?e.jsxs("div",{className:"bg-green-500/10 border border-green-500/30 rounded-xl p-6 text-center",children:[e.jsx(k,{className:"w-12 h-12 text-green-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"Check Your Email!"}),e.jsxs("p",{className:"text-gray-400 mb-4",children:["We've sent a login link to ",e.jsx("span",{className:"text-white font-medium",children:i})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Click the link in your email to access your purchases. The link expires in 1 hour."}),e.jsx("button",{onClick:()=>f(!1),className:"mt-4 text-red-500 hover:text-red-400 text-sm",children:"Use a different email"})]}):e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Email Address"}),e.jsx("input",{type:"email",value:i,onChange:s=>E(s.target.value),placeholder:"your@email.com",className:"w-full px-4 py-3 bg-dark-800 border border-dark-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500",required:!0})]}),b&&e.jsx("div",{className:"text-red-500 text-sm",children:b}),e.jsx("button",{type:"submit",disabled:g||!i,className:"w-full py-3 bg-red-500 hover:bg-red-600 disabled:bg-dark-700 disabled:text-gray-500 text-white font-semibold rounded-lg transition-colors flex items-center justify-center gap-2",children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-white"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"w-5 h-5"}),"Send Login Link"]})}),e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"No password needed! We'll email you a secure login link."})]})]})})}export{le as default};
