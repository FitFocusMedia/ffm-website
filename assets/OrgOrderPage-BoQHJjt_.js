import{u as ae,K as ne,v as ie,a as n,j as e,L}from"./vendor-react-CBAhgyLg.js";import{a as h}from"./app-livestream-Bf1YYS1I.js";import"./vendor-misc-BT9kFnKO.js";import"./feature-video-BYMX8jmn.js";import"./feature-maps-CF1gGmr7.js";import"./vendor-supabase-CIrp0PiG.js";const le="https://gonalgubgldgpkcekaxe.supabase.co",oe=`${le}/functions/v1/content-checkout`;function be(){const{orgSlug:x}=ae(),W=ne();ie();const[j,U]=n.useState(null),[u,M]=n.useState([]),[g,R]=n.useState([]),[P,A]=n.useState([]),[F,y]=n.useState(!0),[$,E]=n.useState(null),[v,de]=n.useState(()=>{const s=new URLSearchParams(window.location.search),t=window.location.hash;return s.get("success")==="true"||t.includes("success=true")}),[N,T]=n.useState(()=>{const s=new URLSearchParams(window.location.search),t=window.location.hash;return s.get("canceled")==="true"||t.includes("canceled=true")});n.useEffect(()=>{if(v||N){const s=window.location.origin+window.location.pathname+"#/order/"+x;window.history.replaceState({},"",s)}},[v,N,x]);const[b,q]=n.useState(1),[d,Y]=n.useState(null),[i,H]=n.useState([]),[r,D]=n.useState({firstName:"",lastName:"",email:"",phone:"",divisions:[],instagram:"",coachName:"",coachInstagram:""}),[w,z]=n.useState(!1);n.useEffect(()=>{V()},[x]);async function V(){y(!0),E(null);const{data:s,error:t}=await h.from("organizations").select("*").eq("slug",x).eq("active",!0).single();if(t||!s){E("Organization not found"),y(!1);return}U(s);const{data:a}=await h.from("events").select("*").eq("organization_id",s.id).eq("active",!0).order("date",{ascending:!1});M(a||[]);const{data:o}=await h.from("packages").select("*").eq("organization_id",s.id).eq("active",!0).order("sort_order");R(o||[]);const{data:l}=await h.from("galleries").select("id, title, slug, event_id, price_per_photo, package_price, package_enabled, pricing_tiers, tiered_pricing_enabled").eq("organization_id",s.id).eq("status","published").order("created_at",{ascending:!1});A(l||[]),y(!1)}function G(s){H(t=>t.includes(s)?t.filter(a=>a!==s):[...t,s])}function c(s){D(t=>({...t,[s.target.name]:s.target.value}))}function B(){return d&&i.length>0}function p(){return u.filter(s=>i.includes(s.id)).some(s=>s.divisions_required===!0)}function k(){const s=r.firstName&&r.lastName&&r.email&&r.phone&&r.instagram&&r.coachName&&r.coachInstagram;return p()?s&&r.divisions.length>0:s}const[f,C]=n.useState([]),[J,S]=n.useState([]),[K,Q]=n.useState([]),[X,I]=n.useState(!1);n.useEffect(()=>{i.length>0?Z():(C([]),S([]))},[i]);async function Z(){I(!0);const{data:s}=await h.from("division_categories").select("*").in("event_id",i).eq("active",!0).order("sort_order");if(s&&s.length>0){C(s);const t=s.map(o=>o.id),{data:a}=await h.from("division_subdivisions").select("*").in("category_id",t).eq("active",!0).order("sort_order");S(a||[])}else C([]),S([]);I(!1)}function ee(s){Q(t=>t.includes(s)?t.filter(a=>a!==s):[...t,s])}function se(s){return J.filter(t=>t.category_id===s)}function O(s,t){const a=`${s} - ${t}`;D(o=>({...o,divisions:o.divisions.includes(a)?o.divisions.filter(l=>l!==a):[...o.divisions,a]}))}function te(s){return r.divisions.filter(t=>t.startsWith(s+" - "))}async function re(){if(k()){z(!0);try{const s=g.find(m=>m.id===d),t=u.filter(m=>i.includes(m.id)).map(m=>m.name).join(", "),a=s.price*i.length,l=await(await fetch(oe,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event_id:i[0],organization_id:j.id,package_id:d,first_name:r.firstName,last_name:r.lastName,email:r.email,phone:r.phone,division:r.divisions.join(", "),instagram:r.instagram,coach_name:r.coachName,coach_instagram:r.coachInstagram,amount:a,success_url:`${window.location.origin}/#/order/${x}?success=true`,cancel_url:`${window.location.origin}/#/order/${x}?canceled=true`})})).json();if(l.url)l.sessionId&&console.log("Checkout session created:",l.sessionId),window.location.href=l.url;else throw new Error("No checkout URL received")}catch(s){console.error("Checkout error:",s),alert("Error creating checkout. Please try again.")}finally{z(!1)}}}return v?e.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-gray-900 rounded-2xl p-8 max-w-md w-full text-center border border-gray-800",children:[e.jsx("div",{className:"w-20 h-20 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx("svg",{className:"w-10 h-10 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),e.jsx("h2",{className:"text-3xl font-bold mb-3",children:"You're Locked In! üé¨"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Thanks for your order! We'll capture your performance at the event and deliver your professionally edited content afterwards."}),e.jsx("p",{className:"text-gray-500 text-sm mb-6",children:"Check your email for confirmation details."}),e.jsx(L,{to:"/content",className:"inline-block px-8 py-3 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700",children:"Back to Events"})]})}):N?e.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-gray-900 rounded-2xl p-8 max-w-md w-full text-center border border-gray-800",children:[e.jsx("div",{className:"w-20 h-20 bg-yellow-500/20 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx("span",{className:"text-4xl",children:"‚ö†Ô∏è"})}),e.jsx("h2",{className:"text-2xl font-bold mb-3",children:"Payment Canceled"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"No worries ‚Äî your order wasn't charged. You can try again whenever you're ready."}),e.jsx("button",{onClick:()=>T(!1),className:"px-8 py-3 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700",children:"Try Again"})]})}):F?e.jsx("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"Loading..."})}):$?e.jsxs("div",{className:"min-h-screen bg-black text-white flex flex-col items-center justify-center gap-4",children:[e.jsx("div",{className:"text-red-500",children:$}),e.jsx(L,{to:"/content",className:"text-gray-400 hover:text-white",children:"‚Üê Back to all organizations"})]}):e.jsx("div",{className:"min-h-screen bg-black text-white py-12 px-4",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsxs("button",{onClick:()=>W("/content"),className:"inline-flex items-center gap-2 text-gray-400 hover:text-white mb-8 mt-4",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"‚Üê All Organizations"]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("span",{className:"inline-block px-4 py-2 bg-red-600/20 text-red-500 rounded-full text-sm font-medium mb-4",children:j.name}),e.jsxs("h1",{className:"text-3xl md:text-4xl font-bold mb-2",children:["Order Your ",e.jsx("span",{className:"text-red-500",children:"Content"})]}),e.jsx("p",{className:"text-gray-400",children:"Select your package and events below"})]}),e.jsx("div",{className:"flex items-center justify-center gap-4 mb-12",children:[{num:1,label:"Package & Events"},{num:2,label:"Your Info"},{num:3,label:"Checkout"}].map((s,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold ${b>=s.num?"bg-red-600 text-white":"bg-gray-700 text-gray-400"}`,children:s.num}),e.jsx("span",{className:`text-sm hidden sm:inline ${b>=s.num?"text-white":"text-gray-500"}`,children:s.label}),t<2&&e.jsx("div",{className:"w-8 h-px bg-gray-700 mx-2"})]},s.num))}),b===1&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-gray-900/50 rounded-xl p-6 border border-gray-800",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Select Package"}),e.jsx("div",{className:"space-y-3",children:g.map(s=>e.jsx("button",{onClick:()=>Y(s.id),className:`w-full p-4 rounded-lg border text-left transition-all ${d===s.id?"border-red-500 bg-red-500/10":"border-gray-700 hover:border-gray-600 bg-gray-800/50"}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:s.name}),e.jsx("div",{className:"text-sm text-gray-400",children:s.description}),s.name.toLowerCase().includes("combo")&&e.jsx("span",{className:"text-xs text-green-500 mt-1 inline-block font-semibold",children:"Save $50"})]}),e.jsxs("div",{className:"text-xl font-bold",children:["$",s.price]})]})},s.id))})]}),P.length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-purple-900/30 to-pink-900/30 rounded-xl p-6 border border-purple-500/30",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-500/20 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-purple-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold text-white",children:["View ",j.name," Galleries"]}),e.jsx("p",{className:"text-purple-300 text-sm",children:"Professional event photos available for purchase"})]})]}),e.jsx("div",{className:"space-y-3",children:P.map(s=>{const t=u.find(a=>a.id===s.event_id);return e.jsx(L,{to:`/gallery/${s.slug}`,className:"block bg-black/30 rounded-lg p-4 border border-purple-500/20 hover:border-purple-500/50 hover:bg-purple-900/20 transition-all",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-white",children:s.title}),e.jsxs("div",{className:"text-sm text-purple-300",children:[t?.name&&e.jsxs("span",{children:[t.name," ‚Ä¢ "]}),"From $",(s.price_per_photo/100).toFixed(2),"/photo",s.tiered_pricing_enabled&&e.jsx("span",{className:"ml-2 text-green-400",children:"‚Ä¢ Volume discounts"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-purple-400",children:[e.jsx("span",{className:"text-sm font-medium",children:"Browse Photos"}),e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]})},s.id)})})]}),e.jsxs("div",{className:"bg-gray-900/50 rounded-xl p-6 border border-gray-800",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Which events did you compete in?"}),u.length===0?e.jsx("p",{className:"text-gray-400",children:"No events available for this organization yet."}):e.jsx("div",{className:"space-y-3",children:u.map(s=>e.jsxs("button",{onClick:()=>G(s.id),className:`w-full p-4 rounded-lg border text-left transition-all flex justify-between items-center ${i.includes(s.id)?"border-red-500 bg-red-500/10":"border-gray-700 hover:border-gray-600 bg-gray-800/50"}`,children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:s.name}),e.jsxs("div",{className:"text-sm text-gray-400",children:[s.date&&new Date(s.date).toLocaleDateString("en-AU",{year:"numeric",month:"short",day:"numeric"}),s.location&&` ‚Äî ${s.location}`]})]}),e.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${i.includes(s.id)?"border-red-500 bg-red-500":"border-gray-600"}`,children:i.includes(s.id)&&e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})]},s.id))})]}),e.jsx("button",{onClick:()=>q(2),disabled:!B(),className:`w-full py-4 rounded-lg font-semibold text-lg transition-all ${B()?"bg-red-600 hover:bg-red-700 text-white":"bg-gray-700 text-gray-500 cursor-not-allowed"}`,children:"Continue ‚Üí"})]}),b===2&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-900/50 rounded-xl p-6 border border-gray-800",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Your Information"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"First Name *"}),e.jsx("input",{type:"text",name:"firstName",value:r.firstName,onChange:c,className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg focus:border-red-500 focus:outline-none",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Last Name *"}),e.jsx("input",{type:"text",name:"lastName",value:r.lastName,onChange:c,className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg focus:border-red-500 focus:outline-none",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Email *"}),e.jsx("input",{type:"email",name:"email",value:r.email,onChange:c,className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg focus:border-red-500 focus:outline-none",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Phone *"}),e.jsx("input",{type:"tel",name:"phone",value:r.phone,onChange:c,className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg focus:border-red-500 focus:outline-none",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Instagram Handle *"}),e.jsx("input",{type:"text",name:"instagram",value:r.instagram,onChange:c,placeholder:"@yourhandle",className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg focus:border-red-500 focus:outline-none",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Coach's Name *"}),e.jsx("input",{type:"text",name:"coachName",value:r.coachName,onChange:c,className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg focus:border-red-500 focus:outline-none",required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Coach's Instagram Handle *"}),e.jsx("input",{type:"text",name:"coachInstagram",value:r.coachInstagram,onChange:c,placeholder:"@coachhandle",className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg focus:border-red-500 focus:outline-none",required:!0})]})]})]}),(f.length>0||p())&&e.jsxs("div",{className:"bg-gray-900/50 rounded-xl p-6 border border-gray-800",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-2",children:["Division/Category ",p()?"*":"(Optional)"]}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:f.length>0?"Click a category to expand, then select your divisions":"No divisions configured for this event"}),X?e.jsx("div",{className:"text-center text-gray-400 py-8",children:"Loading divisions..."}):f.length===0?e.jsxs("div",{className:"text-center text-gray-400 py-8 border border-gray-700 rounded-lg",children:["No divisions configured for the selected event(s).",p()&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{className:"text-sm text-red-400",children:"Contact the organizer to set up divisions."})]})]}):e.jsx("div",{className:"space-y-2",children:f.map(s=>{const t=K.includes(s.id),a=te(s.name).length,o=se(s.id);return e.jsxs("div",{className:"border border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("button",{type:"button",onClick:()=>ee(s.id),className:`w-full p-4 flex justify-between items-center transition-colors ${a>0?"bg-red-500/10 border-l-4 border-l-red-500":"bg-gray-800/50 hover:bg-gray-800"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-medium",children:s.name}),a>0&&e.jsxs("span",{className:"text-xs bg-red-500 text-white px-2 py-0.5 rounded-full",children:[a," selected"]})]}),e.jsx("svg",{className:`w-5 h-5 text-gray-400 transition-transform ${t?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),t&&e.jsx("div",{className:"p-4 pt-2 bg-gray-900/50 border-t border-gray-700",children:o.length===0?e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No subdivisions available"}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:o.map(l=>{const m=`${s.name} - ${l.name}`,_=r.divisions.includes(m);return e.jsx("button",{type:"button",onClick:()=>O(s.name,l.name),className:`p-3 text-sm rounded-lg border text-left transition-all ${_?"border-red-500 bg-red-500/20 text-white":"border-gray-600 hover:border-gray-500 bg-gray-800/50 text-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-4 h-4 rounded border-2 flex items-center justify-center ${_?"border-red-500 bg-red-500":"border-gray-500"}`,children:_&&e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),e.jsx("span",{children:l.name})]})},l.id)})})})]},s.id)})}),r.divisions.length>0&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-800/50 rounded-lg border border-gray-700",children:[e.jsxs("div",{className:"text-sm text-gray-400 mb-2",children:["Selected divisions (",r.divisions.length,"):"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.divisions.map(s=>e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs bg-red-500/20 text-red-400 px-2 py-1 rounded-full border border-red-500/30",children:[s,e.jsx("button",{type:"button",onClick:()=>{const[t,a]=s.split(" - ");O(t,a)},className:"hover:text-white",children:"√ó"})]},s))})]})]}),e.jsxs("div",{className:"bg-gray-900/50 rounded-xl p-6 border border-gray-800",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Order Summary"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Package:"}),e.jsx("span",{children:g.find(s=>s.id===d)?.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Events:"}),e.jsx("span",{className:"text-right",children:u.filter(s=>i.includes(s.id)).map(s=>s.name).join(", ")})]}),e.jsx("hr",{className:"border-gray-700 my-3"}),e.jsxs("div",{className:"flex justify-between text-lg font-semibold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-red-500",children:["$",(g.find(s=>s.id===d)?.price||0)*i.length," AUD",i.length>1&&e.jsxs("span",{className:"text-sm text-gray-400 font-normal ml-2",children:["($",g.find(s=>s.id===d)?.price," √ó ",i.length," events)"]})]})]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>q(1),className:"flex-1 py-4 rounded-lg font-semibold border border-gray-600 hover:border-gray-500 transition-colors",children:"‚Üê Back"}),e.jsx("button",{onClick:re,disabled:!k()||w,className:`flex-1 py-4 rounded-lg font-semibold transition-all ${k()&&!w?"bg-red-600 hover:bg-red-700 text-white":"bg-gray-700 text-gray-500 cursor-not-allowed"}`,children:w?"Processing...":"Proceed to Payment ‚Üí"})]})]})]})})}export{be as default};
