import{u as V,v as X,a as l,j as e,aj as G,ak as Q,m as L,al as W,am as R,an as H,ao as Z,ap as ee,c as te,x as se,b as ae,aa as B,a3 as le}from"./vendor-react-CBAhgyLg.js";import{a as I}from"./app-livestream-Bf1YYS1I.js";function ne(x,r,t){if(!r||!Array.isArray(r)||r.length===0)return{total:x*t,breakdown:[{qty:x,price:t,subtotal:x*t}],savings:0};const N=[...r].sort((i,u)=>i.min_qty-u.min_qty);let n=x,p=0;const o=[];for(const i of N){if(n<=0)break;const u=i.min_qty,j=i.max_qty||1/0,v=i.price_per_photo,f=j===1/0?n:j-u+1,b=Math.min(n,f);if(b>0){const w=b*v;p+=w,o.push({tier:`${u}-${j===1/0?"+":j}`,qty:b,price:v,subtotal:w}),n-=b}}if(n>0){const i=n*t;p+=i,o.push({tier:"standard",qty:n,price:t,subtotal:i})}const h=x*t,_=h-p;return{total:p,breakdown:o,savings:_,flatTotal:h}}function re(){const{slug:x}=V(),[r]=X(),[t,N]=l.useState(null),[n,p]=l.useState([]),[o,h]=l.useState(new Set),[_,i]=l.useState(!0),[u,j]=l.useState(null),[v,f]=l.useState(!1),[b,w]=l.useState(!1),[z,A]=l.useState(null),[a,m]=l.useState(0),[g,S]=l.useState(null),$=r.get("cancelled");l.useEffect(()=>{const s=window.innerWidth<768,d=localStorage.getItem("gallery_tutorial_seen");s&&!d&&n.length>0&&m(1)},[n]),l.useEffect(()=>{if(a===4&&g){const s=setTimeout(()=>{h(d=>{const k=new Set(d);return k.delete(g),k}),S(null),m(5)},1500);return()=>clearTimeout(s)}},[a,g]),l.useEffect(()=>{if(a===5){const s=setTimeout(()=>{m(0)},2500);return()=>clearTimeout(s)}},[a]),l.useEffect(()=>{E()},[x]);const E=async()=>{try{const{data:s,error:d}=await I.from("galleries").select(`
          id, title, description, slug, price_per_photo, package_price, package_enabled,
          pricing_tiers, tiered_pricing_enabled,
          organizations(id, name, display_name)
        `).eq("slug",x).eq("status","published").single();if(d)throw d;N(s);const{data:k,error:C}=await I.from("gallery_photos").select("id, filename, width, height, price, sort_order, watermarked_path, thumbnail_path").eq("gallery_id",s.id).order("sort_order",{ascending:!0});if(C)throw C;const P=await Promise.all(k.map(async Y=>{const{data:M}=await I.storage.from("galleries").createSignedUrl(Y.watermarked_path,3600);return{...Y,watermarked_url:M?.signedUrl,thumbnail_url:M?.signedUrl,price:Y.price||s.price_per_photo}}));p(P)}catch(s){console.error("Load gallery error:",s),j("Gallery not found")}finally{i(!1)}},q=s=>{const d=new Set(o);d.has(s)?d.delete(s):d.add(s),h(d)},F=()=>{h(new Set(n.map(s=>s.id)))},O=()=>{h(new Set)},D=l.useMemo(()=>{const s=o.size;if(s===0||!t)return{total:0,savings:0,breakdown:[],flatTotal:0};if(t.tiered_pricing_enabled&&t.pricing_tiers?.length>0)return ne(s,t.pricing_tiers,t.price_per_photo);const d=s*t.price_per_photo;return{total:d,savings:0,breakdown:[],flatTotal:d}},[o.size,t]),T=async(s,d,k=!1)=>{w(!0),j(null);try{const C=await fetch("https://gonalgubgldgpkcekaxe.supabase.co/functions/v1/gallery_checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({gallery_slug:x,email:s,customer_name:d,photo_ids:k?[]:Array.from(o),is_package:k})}),P=await C.json();if(!C.ok)throw new Error(P.error||"Checkout failed");P.checkout_url&&(window.location.href=P.checkout_url)}catch(C){console.error("Checkout error:",C),j(C.message)}finally{w(!1)}};return _?e.jsx("div",{className:"min-h-[60vh] flex items-center justify-center",children:e.jsx(G,{className:"w-8 h-8 text-red-500 animate-spin"})}):u&&!t?e.jsx("div",{className:"min-h-[60vh] flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Gallery Not Found"}),e.jsx("p",{className:"text-gray-400",children:u})]})}):e.jsx("div",{className:"py-8 px-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:t.title}),t.livestream_events&&e.jsx("p",{className:"text-gray-400",children:t.livestream_events.title}),t.description&&e.jsx("p",{className:"text-gray-300 mt-4",children:t.description})]}),$&&e.jsx("div",{className:"mb-6 p-4 bg-yellow-500/20 border border-yellow-500/50 rounded-lg text-yellow-300",children:"Checkout was cancelled. Your selection is still saved."}),e.jsxs("div",{className:"mb-6 space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[e.jsxs("div",{className:"bg-dark-800 px-4 py-2 rounded-lg",children:[e.jsx("span",{className:"text-gray-400",children:"Per Photo:"}),e.jsxs("span",{className:"text-white ml-2 font-semibold",children:["$",(t.price_per_photo/100).toFixed(2)]})]}),t.package_enabled&&t.package_price&&e.jsxs("div",{className:"bg-dark-800 px-4 py-2 rounded-lg",children:[e.jsx("span",{className:"text-gray-400",children:"All Photos:"}),e.jsxs("span",{className:"text-green-400 ml-2 font-semibold",children:["$",(t.package_price/100).toFixed(2)]}),e.jsxs("span",{className:"text-gray-500 ml-1",children:["(save $",((n.length*t.price_per_photo-t.package_price)/100).toFixed(2),")"]})]})]}),t.tiered_pricing_enabled&&t.pricing_tiers?.length>0&&e.jsxs("div",{className:"bg-gradient-to-r from-green-500/10 to-green-500/5 border border-green-500/30 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-400 font-semibold mb-3",children:[e.jsx(Q,{className:"w-4 h-4"}),"Volume Discounts"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 text-sm",children:t.pricing_tiers.map((s,d)=>e.jsxs("div",{className:"bg-dark-800/50 rounded px-3 py-2",children:[e.jsxs("span",{className:"text-gray-400",children:[s.max_qty?`${s.min_qty}-${s.max_qty}`:`${s.min_qty}+`," photos:"]}),e.jsxs("span",{className:"text-white ml-2 font-semibold",children:["$",(s.price_per_photo/100).toFixed(2)," each"]})]},d))})]})]}),e.jsxs("div",{className:"mb-6 flex flex-wrap items-center gap-4",children:[e.jsxs("button",{onClick:F,className:"text-sm text-gray-400 hover:text-white",children:["Select All (",n.length,")"]}),o.size>0&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:O,className:"text-sm text-gray-400 hover:text-white",children:"Clear Selection"}),e.jsxs("span",{className:"text-white",children:[o.size," selected Â· $",(D.total/100).toFixed(2),D.savings>0&&e.jsxs("span",{className:"text-green-400 ml-2",children:["(saving $",(D.savings/100).toFixed(2),")"]})]})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-2 md:gap-4 mb-24 md:mb-8",children:n.map((s,d)=>e.jsxs("div",{className:`relative group cursor-pointer rounded-lg overflow-hidden transition-transform active:scale-98 ${o.has(s.id)?"ring-2 ring-red-500":""} ${a===1&&d===0?"ring-2 ring-white animate-pulse z-10":""}`,onClick:()=>{A(s),a===1&&m(2)},children:[e.jsx("img",{src:s.thumbnail_url||s.watermarked_url,alt:s.filename,className:"w-full aspect-square object-cover",loading:"lazy"}),e.jsx("div",{className:`absolute top-2 right-2 w-7 h-7 rounded-full flex items-center justify-center transition-all ${o.has(s.id)?"bg-red-500 text-white":"bg-black/40 text-white md:opacity-0 md:group-hover:opacity-100"}`,children:o.has(s.id)?e.jsx(L,{className:"w-4 h-4"}):e.jsx(W,{className:"w-4 h-4"})}),e.jsx("button",{onClick:k=>{k.stopPropagation(),q(s.id)},className:`absolute bottom-2 left-2 px-3 py-1 rounded-full text-xs font-semibold transition-all md:opacity-0 md:group-hover:opacity-100 ${o.has(s.id)?"bg-green-500 text-white":"bg-black/60 backdrop-blur-sm text-white"}`,children:o.has(s.id)?"Added":"Add"})]},s.id))}),(o.size>0||t.package_enabled)&&e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 md:bottom-4 md:left-auto md:right-8 md:w-96 z-40",children:[e.jsxs("div",{className:"md:hidden bg-dark-900/95 backdrop-blur-lg border-t border-dark-700 px-4 py-3 safe-area-pb",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-dark-700 rounded-full px-3 py-1.5",children:[e.jsx(R,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"text-white font-semibold text-sm",children:o.size})]}),e.jsxs("div",{className:"flex-1 text-right",children:[D.savings>0&&e.jsxs("span",{className:"text-gray-500 text-xs line-through mr-2",children:["$",(D.flatTotal/100).toFixed(2)]}),e.jsxs("span",{className:"text-white font-bold",children:["$",(D.total/100).toFixed(2)]})]}),e.jsx("button",{onClick:()=>f(!0),disabled:o.size===0,className:"bg-red-500 hover:bg-red-600 disabled:bg-gray-600 text-white font-semibold px-5 py-2 rounded-full transition-all active:scale-95",children:"Checkout"})]}),t.package_enabled&&t.package_price&&e.jsxs("button",{onClick:()=>{F(),f(!0)},className:"w-full mt-2 bg-green-600/20 border border-green-500/50 text-green-400 font-semibold py-2 rounded-full text-sm transition-all active:scale-98",children:["Buy All ",n.length," Photos - $",(t.package_price/100).toFixed(2)]})]}),e.jsxs("div",{className:"hidden md:block bg-dark-800 rounded-xl shadow-2xl p-4 border border-dark-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5 text-red-500"}),e.jsxs("span",{className:"text-white font-semibold",children:[o.size," photos selected"]})]}),e.jsxs("span",{className:"text-white font-bold",children:["$",(D.total/100).toFixed(2)]})]}),D.savings>0&&e.jsxs("div",{className:"flex items-center justify-between mb-3 text-sm",children:[e.jsx("span",{className:"text-gray-400",children:e.jsxs("span",{className:"line-through",children:["$",(D.flatTotal/100).toFixed(2)]})}),e.jsxs("span",{className:"text-green-400 font-semibold",children:["Volume discount: -$",(D.savings/100).toFixed(2)]})]}),e.jsx("button",{onClick:()=>f(!0),disabled:o.size===0,className:"w-full bg-red-500 hover:bg-red-600 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-semibold py-3 rounded-lg transition-colors",children:"Checkout"}),t.package_enabled&&t.package_price&&e.jsxs("button",{onClick:()=>{F(),f(!0)},className:"w-full mt-2 bg-green-600 hover:bg-green-700 text-white font-semibold py-3 rounded-lg transition-colors",children:["Buy All Photos - $",(t.package_price/100).toFixed(2)]})]})]}),v&&e.jsx(ie,{gallery:t,selectedCount:o.size,priceCalc:D,isPackage:o.size===n.length&&t.package_enabled,packagePrice:t.package_price,onClose:()=>f(!1),onCheckout:T,purchasing:b,error:u}),a===1&&n.length>0&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-30 flex items-center justify-center pointer-events-none md:hidden",children:e.jsxs("div",{className:"bg-white/10 backdrop-blur-md rounded-2xl p-6 mx-4 text-center animate-bounce-slow",children:[e.jsx("div",{className:"text-4xl mb-3",children:"ðŸ‘†"}),e.jsx("p",{className:"text-white text-lg font-semibold",children:"Tap a photo to view"}),e.jsx("p",{className:"text-white/70 text-sm mt-1",children:"Open the fullscreen gallery"})]})}),z&&e.jsx(oe,{photos:n,currentPhoto:z,selectedPhotos:o,onClose:()=>{A(null),a>0&&a<4&&m(0)},onNavigate:A,onToggleSelect:q,pricePerPhoto:t.price_per_photo,tutorialStep:a,onTutorialStep:(s,d)=>{m(s),s===4&&d&&(localStorage.setItem("gallery_tutorial_seen","true"),S(d))}})]})})}function ie({gallery:x,selectedCount:r,priceCalc:t,isPackage:N,packagePrice:n,onClose:p,onCheckout:o,purchasing:h,error:_}){const[i,u]=l.useState(""),[j,v]=l.useState(""),f=N&&n?n:t.total,b=w=>{w.preventDefault(),o(i,j,N&&n)};return e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-dark-800 rounded-xl max-w-md w-full p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Complete Purchase"}),e.jsxs("div",{className:"mb-6 p-4 bg-dark-700 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between text-gray-300 mb-2",children:[e.jsxs("span",{children:[r," photos"]}),e.jsxs("span",{children:["$",(t.flatTotal/100).toFixed(2)]})]}),t.savings>0&&!N&&e.jsxs("div",{className:"flex justify-between text-green-400 mb-2",children:[e.jsx("span",{children:"Volume Discount"}),e.jsxs("span",{children:["-$",(t.savings/100).toFixed(2)]})]}),N&&n&&t.flatTotal>n&&e.jsxs("div",{className:"flex justify-between text-green-400 mb-2",children:[e.jsx("span",{children:"Package Discount"}),e.jsxs("span",{children:["-$",((t.flatTotal-n)/100).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-white font-bold mt-2 pt-2 border-t border-dark-600",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["$",(f/100).toFixed(2)," AUD"]})]})]}),e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-400 mb-1",children:"Email *"}),e.jsx("input",{type:"email",value:i,onChange:w=>u(w.target.value),className:"w-full bg-dark-700 text-white rounded-lg px-4 py-3 border border-dark-600 focus:border-red-500 focus:outline-none",placeholder:"your@email.com",required:!0}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"Download link will be sent here"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-400 mb-1",children:"Name (optional)"}),e.jsx("input",{type:"text",value:j,onChange:w=>v(w.target.value),className:"w-full bg-dark-700 text-white rounded-lg px-4 py-3 border border-dark-600 focus:border-red-500 focus:outline-none",placeholder:"Your name"})]}),_&&e.jsx("div",{className:"p-3 bg-red-500/20 border border-red-500/50 rounded-lg text-red-300 text-sm",children:_}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:p,className:"flex-1 bg-dark-600 hover:bg-dark-500 text-white py-3 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:h||!i,className:"flex-1 bg-red-500 hover:bg-red-600 disabled:bg-gray-600 text-white py-3 rounded-lg transition-colors flex items-center justify-center gap-2",children:h?e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-4 h-4 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:["Pay $",(f/100).toFixed(2)]})})]})]})]})})}function oe({photos:x,currentPhoto:r,selectedPhotos:t,onClose:N,onNavigate:n,onToggleSelect:p,pricePerPhoto:o,tutorialStep:h=0,onTutorialStep:_}){const i=x.findIndex(c=>c.id===r.id),u=t.has(r.id),j=l.useRef(null),[v,f]=l.useState(0),[b,w]=l.useState(!1),[z,A]=l.useState(0),[a,m]=l.useState(!1),[g,S]=l.useState(!1),[$,E]=l.useState(0),[q,F]=l.useState(!1),[O,D]=l.useState({x:0,y:0}),T=i>0?x[i-1]:null,s=i<x.length-1?x[i+1]:null;l.useEffect(()=>{const c=window.scrollY;return document.body.style.position="fixed",document.body.style.top=`-${c}px`,document.body.style.left="0",document.body.style.right="0",document.body.style.overflow="hidden",()=>{document.body.style.position="",document.body.style.top="",document.body.style.left="",document.body.style.right="",document.body.style.overflow="",window.scrollTo(0,c)}},[]);const d=l.useCallback(()=>{i<x.length-1&&n(x[i+1])},[i,x,n]),k=l.useCallback(()=>{i>0&&n(x[i-1])},[i,x,n]);l.useEffect(()=>{const c=y=>{y.key==="ArrowDown"||y.key==="ArrowRight"?(y.preventDefault(),d()):y.key==="ArrowUp"||y.key==="ArrowLeft"?(y.preventDefault(),k()):y.key==="Escape"?N():(y.key===" "||y.key==="Enter")&&(y.preventDefault(),p(r.id))};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[d,k,N,p,r.id]);const C=c=>{A(c.touches[0].clientY),w(!0),f(0)},P=c=>{if(!b)return;const y=c.touches[0].clientY-z;f(y)},Y=()=>{w(!1);const c=80;v<-c&&s?(d(),h===2&&!a&&(m(!0),g&&_?.(3))):v>c&&T&&(k(),h===2&&!g&&(S(!0),a&&_?.(3))),f(0)},M=c=>{const y=Date.now();if(y-$<300){const U=c.currentTarget.getBoundingClientRect(),J=c.clientX||U.width/2,K=c.clientY||U.height/2;D({x:J-U.left,y:K-U.top}),F(!0),t.has(r.id)||(p(r.id),h===3&&_?.(4,r.id)),setTimeout(()=>F(!1),800)}E(y)};return l.useEffect(()=>{if(T){const c=new Image;c.src=T.watermarked_url}if(s){const c=new Image;c.src=s.watermarked_url}},[T,s]),e.jsxs("div",{ref:j,className:"fixed inset-0 bg-black z-50 overflow-hidden",style:{touchAction:"none"},onTouchStart:C,onTouchMove:P,onTouchEnd:Y,onClick:M,children:[s&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4 pt-16 pb-24",children:e.jsx("img",{src:s.watermarked_url,alt:"Next",className:"max-w-full max-h-full object-contain",draggable:!1})}),T&&v>0&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4 pt-16 pb-24",children:e.jsx("img",{src:T.watermarked_url,alt:"Previous",className:"max-w-full max-h-full object-contain",draggable:!1})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4 pt-16 pb-24 bg-black",style:{transform:`translateY(${v}px)`,transition:b?"none":"transform 0.25s ease-out"},children:e.jsx("img",{src:r.watermarked_url,alt:r.filename,className:"max-w-full max-h-full object-contain select-none",draggable:!1})}),q&&e.jsx("div",{className:"absolute pointer-events-none z-50",style:{left:O.x,top:O.y,transform:"translate(-50%, -50%)"},children:e.jsx(H,{className:"w-20 h-20 text-red-500 fill-red-500",style:{animation:"heartBurst 0.6s ease-out forwards"}})}),e.jsxs("div",{className:"absolute top-0 left-0 right-0 z-40 flex items-center justify-between p-4 bg-gradient-to-b from-black/70 to-transparent",children:[e.jsxs("div",{className:"text-white/90 font-medium text-sm bg-black/40 px-3 py-1.5 rounded-full backdrop-blur-sm",children:[i+1," / ",x.length]}),e.jsx("button",{onClick:N,className:"text-white bg-black/40 hover:bg-black/60 p-2.5 rounded-full backdrop-blur-sm transition-colors",children:e.jsx(Z,{className:"w-5 h-5"})})]}),T&&e.jsx("button",{onClick:c=>{c.stopPropagation(),k()},className:"hidden md:flex absolute left-4 top-1/2 -translate-y-1/2 z-40 bg-black/50 hover:bg-black/70 text-white p-3 rounded-full",children:e.jsx(ee,{className:"w-6 h-6"})}),s&&e.jsx("button",{onClick:c=>{c.stopPropagation(),d()},className:"hidden md:flex absolute right-4 top-1/2 -translate-y-1/2 z-40 bg-black/50 hover:bg-black/70 text-white p-3 rounded-full",children:e.jsx(te,{className:"w-6 h-6"})}),e.jsxs("div",{className:"md:hidden absolute right-3 bottom-28 z-40 flex flex-col items-center gap-4",children:[e.jsxs("button",{onClick:c=>{c.stopPropagation(),p(r.id)},className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:`p-3 rounded-full transition-all shadow-lg ${u?"bg-red-500 text-white scale-110":"bg-black/60 text-white backdrop-blur-sm"}`,children:u?e.jsx(L,{className:"w-6 h-6"}):e.jsx(R,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-white text-xs font-medium drop-shadow",children:u?"Added":"Add"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:`p-3 rounded-full shadow-lg ${u?"bg-black/60 text-red-500":"bg-black/60 text-white/70"} backdrop-blur-sm`,children:e.jsx(H,{className:`w-6 h-6 ${u?"fill-red-500":""}`})}),e.jsx("span",{className:"text-white/80 text-xs font-medium drop-shadow",children:u?"Added":"Add"})]})]}),e.jsxs("div",{className:"hidden md:flex p-4 bg-gradient-to-t from-black/80 to-transparent items-center justify-between absolute bottom-0 left-0 right-0 z-40",children:[e.jsx("div",{className:"text-gray-300 text-sm truncate max-w-[50%]",children:r.filename}),e.jsx("button",{onClick:()=>p(r.id),className:`flex items-center gap-2 px-5 py-2.5 rounded-full font-semibold transition-all ${u?"bg-green-500 hover:bg-green-600 text-white":"bg-red-500 hover:bg-red-600 text-white"}`,children:u?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-5 h-5"}),"In Cart"]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-5 h-5"}),"Add $",(o/100).toFixed(2)]})})]}),e.jsxs("div",{className:"hidden md:flex absolute bottom-16 left-1/2 -translate-x-1/2 text-gray-500 text-xs gap-4 z-40",children:[e.jsx("span",{children:"â†‘ â†“ Navigate"}),e.jsx("span",{children:"Space: Add to cart"}),e.jsx("span",{children:"Esc: Close"})]}),h===0&&e.jsx("div",{className:"md:hidden absolute left-4 bottom-28 z-40 text-white/40 text-xs",children:"Double-tap to add"}),h===2&&e.jsx("div",{className:"md:hidden absolute inset-x-0 bottom-40 z-50 flex justify-center pointer-events-none",children:e.jsxs("div",{className:"bg-white/10 backdrop-blur-md rounded-2xl p-5 mx-4 text-center",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ðŸ‘†ðŸ‘‡"}),e.jsx("p",{className:"text-white text-lg font-semibold",children:"Swipe up or down"}),e.jsx("p",{className:"text-white/70 text-sm mt-1",children:"Browse through photos"})]})}),h===3&&e.jsx("div",{className:"md:hidden absolute inset-0 z-50 flex items-center justify-center pointer-events-none",children:e.jsxs("div",{className:"bg-white/10 backdrop-blur-md rounded-2xl p-6 mx-4 text-center",children:[e.jsx("div",{className:"text-4xl mb-2 animate-double-tap",children:"â˜ï¸"}),e.jsx("p",{className:"text-white text-lg font-semibold",children:"Double-tap to add to cart"}),e.jsx("p",{className:"text-white/70 text-sm mt-1",children:"Try it on this photo!"})]})}),h===4&&e.jsx("div",{className:"md:hidden absolute inset-0 z-50 flex items-center justify-center pointer-events-none",children:e.jsxs("div",{className:"bg-green-500/20 backdrop-blur-md rounded-2xl p-6 mx-4 text-center animate-pulse",children:[e.jsx("div",{className:"text-4xl mb-2",children:"âœ…"}),e.jsx("p",{className:"text-white text-lg font-semibold",children:"You're all set!"}),e.jsx("p",{className:"text-white/70 text-sm mt-1",children:"Swipe to browse, double-tap to add"})]})}),h===5&&e.jsx("div",{className:"md:hidden absolute top-14 right-14 z-50 pointer-events-none animate-fade-hint",children:e.jsx("div",{className:"bg-black/40 backdrop-blur-sm rounded-lg px-3 py-1.5",children:e.jsx("span",{className:"text-white/60 text-xs",children:"Grid view"})})}),e.jsx("style",{children:`
        @keyframes heartBurst {
          0% {
            transform: translate(-50%, -50%) scale(0);
            opacity: 1;
          }
          50% {
            transform: translate(-50%, -50%) scale(1.2);
            opacity: 1;
          }
          100% {
            transform: translate(-50%, -50%) scale(1);
            opacity: 0;
          }
        }
        @keyframes fadeOut {
          0% { opacity: 1; }
          70% { opacity: 1; }
          100% { opacity: 0; }
        }
        .animate-fade-out {
          animation: fadeOut 3s ease-out forwards;
        }
        .safe-area-pb {
          padding-bottom: max(12px, env(safe-area-inset-bottom));
        }
        @keyframes bounce-slow {
          0%, 100% { transform: translateY(0); }
          50% { transform: translateY(-10px); }
        }
        .animate-bounce-slow {
          animation: bounce-slow 2s ease-in-out infinite;
        }
        @keyframes double-tap {
          0%, 100% { transform: scale(1); }
          10% { transform: scale(0.85) translateY(5px); }
          20% { transform: scale(1); }
          30% { transform: scale(0.85) translateY(5px); }
          40% { transform: scale(1); }
        }
        .animate-double-tap {
          animation: double-tap 1.5s ease-in-out infinite;
        }
        @keyframes fade-hint {
          0% { opacity: 0; }
          15% { opacity: 1; }
          85% { opacity: 1; }
          100% { opacity: 0; }
        }
        .animate-fade-hint {
          animation: fade-hint 2.5s ease-in-out forwards;
        }
      `})]})}const xe=Object.freeze(Object.defineProperty({__proto__:null,default:re},Symbol.toStringTag,{value:"Module"}));function de(){const{token:x}=V(),[r,t]=l.useState(null),[N,n]=l.useState(!0),[p,o]=l.useState(null),[h,_]=l.useState(null),[i,u]=l.useState(new Set);l.useEffect(()=>{j()},[x]);const j=async()=>{try{const a=await fetch(`https://gonalgubgldgpkcekaxe.supabase.co/functions/v1/gallery_download?token=${x}`),m=await a.json();if(!a.ok)throw new Error(m.error||"Failed to load order");t(m.order);const g=new Set;m.order.gallery_order_items?.forEach(S=>{S.downloaded&&g.add(S.photo_id)}),u(g)}catch(a){console.error("Load order error:",a),o(a.message)}finally{n(!1)}},v=async(a,m)=>{_(a);try{const g=await fetch(`https://gonalgubgldgpkcekaxe.supabase.co/functions/v1/gallery_download?token=${x}&photo_id=${a}`),S=await g.json();if(!g.ok)throw new Error(S.error||"Download failed");const $=document.createElement("a");$.href=S.download_url,$.download=m,document.body.appendChild($),$.click(),document.body.removeChild($),u(E=>new Set([...E,a]))}catch(g){console.error("Download error:",g),alert("Download failed: "+g.message)}finally{_(null)}},f=async()=>{const a=r.gallery_order_items||[];for(const m of a)i.has(m.photo_id)||(await v(m.photo_id,m.gallery_photos?.filename||`photo-${m.photo_id}.jpg`),await new Promise(g=>setTimeout(g,500)))};if(N)return e.jsx("div",{className:"min-h-[60vh] flex items-center justify-center",children:e.jsx(G,{className:"w-8 h-8 text-red-500 animate-spin"})});if(p)return e.jsx("div",{className:"min-h-[60vh] flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx(se,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:p==="Download link has expired"?"Link Expired":"Access Denied"}),e.jsx("p",{className:"text-gray-400 mb-4",children:p}),p==="Download link has expired"&&e.jsx("p",{className:"text-gray-500 text-sm",children:"Download links expire after 7 days. Please contact us if you need a new link."})]})});const b=r.gallery_order_items||[],w=b.every(a=>i.has(a.photo_id)),z=new Date(r.token_expires_at),A=Math.ceil((z-new Date)/(1e3*60*60*24));return e.jsx("div",{className:"py-8 px-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(L,{className:"w-8 h-8 text-green-500"})}),e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Your Photos Are Ready!"}),e.jsxs("p",{className:"text-gray-400",children:["Thank you for your purchase from ",r.galleries?.title]})]}),e.jsxs("div",{className:"mb-6 p-4 bg-dark-800 rounded-lg flex items-center gap-3",children:[e.jsx(ae,{className:"w-5 h-5 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-300",children:"Downloads available for "}),e.jsxs("span",{className:"text-white font-semibold",children:[A," more days"]}),e.jsxs("span",{className:"text-gray-500 text-sm ml-2",children:["(expires ",z.toLocaleDateString(),")"]})]})]}),b.length>1&&!w&&e.jsxs("button",{onClick:f,disabled:h,className:"w-full mb-6 bg-red-500 hover:bg-red-600 disabled:bg-gray-600 text-white font-semibold py-4 rounded-lg transition-colors flex items-center justify-center gap-2",children:[e.jsx(B,{className:"w-5 h-5"}),"Download All (",b.length," photos)"]}),e.jsx("div",{className:"space-y-4",children:b.map(a=>{const m=a.gallery_photos,g=i.has(a.photo_id),S=h===a.photo_id;return e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 flex items-center gap-4",children:[e.jsx("div",{className:"w-20 h-20 bg-dark-700 rounded-lg overflow-hidden flex-shrink-0",children:m?e.jsx(le,{className:"w-full h-full text-gray-600 p-4"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-500",children:"No preview"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-white font-medium truncate",children:m?.filename||`Photo ${a.photo_id}`}),m&&e.jsxs("p",{className:"text-gray-500 text-sm",children:[m.width," Ã— ",m.height]}),g&&a.download_count>0&&e.jsxs("p",{className:"text-gray-500 text-xs mt-1",children:["Downloaded ",a.download_count," time",a.download_count>1?"s":""]})]}),e.jsx("button",{onClick:()=>v(a.photo_id,m?.filename||`photo-${a.photo_id}.jpg`),disabled:S,className:`flex-shrink-0 px-4 py-2 rounded-lg flex items-center gap-2 transition-colors ${g?"bg-green-600/20 text-green-400 hover:bg-green-600/30":"bg-red-500 hover:bg-red-600 text-white"}`,children:S?e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"Downloading..."})]}):g?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4"}),e.jsx("span",{children:"Download Again"})]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-4 h-4"}),e.jsx("span",{children:"Download"})]})})]},a.id)})}),e.jsxs("div",{className:"mt-8 p-6 bg-dark-800 rounded-lg",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Order Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Order ID:"}),e.jsx("span",{className:"text-white ml-2 font-mono",children:r.id.slice(0,8)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Email:"}),e.jsx("span",{className:"text-white ml-2",children:r.email})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Total Paid:"}),e.jsxs("span",{className:"text-white ml-2",children:["$",(r.total_amount/100).toFixed(2)," AUD"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Date:"}),e.jsx("span",{className:"text-white ml-2",children:new Date(r.completed_at||r.created_at).toLocaleDateString()})]})]})]}),e.jsx("div",{className:"mt-6 text-center text-gray-500 text-sm",children:e.jsx("p",{children:"Having trouble? Contact us at info@fitfocusmedia.com.au"})})]})})}const he=Object.freeze(Object.defineProperty({__proto__:null,default:de},Symbol.toStringTag,{value:"Module"}));export{he as D,xe as P};
